<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>Da&#39;sBlog</title>
  
  <link href="/atom.xml" rel="self"/>
  
  <link href="http://sunhao.win/"/>
  <updated>2017-05-09T06:15:16.959Z</updated>
  <id>http://sunhao.win/</id>
  
  <author>
    <name>Sun Hao</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>nginx重启，重载，测试，配置</title>
    <link href="http://sunhao.win/articles/nginx-config.html"/>
    <id>http://sunhao.win/articles/nginx-config.html</id>
    <published>2017-05-09T06:13:42.000Z</published>
    <updated>2017-05-09T06:15:16.959Z</updated>
    
    <content type="html"><![CDATA[<p>nginx -s reload  ：修改配置后重新加载生效<br>nginx -s reopen  ：重新打开日志文件<br>nginx -t -c /path/to/nginx.conf 测试nginx配置文件是否正确</p>
<p>关闭nginx：<br>nginx -s stop  :快速停止nginx<br>         quit  ：完整有序的停止nginx</p>
<p>其他的停止nginx 方式：</p>
<p>ps -ef | grep nginx</p>
<p>kill -QUIT 主进程号     ：从容停止Nginx<br>kill -TERM 主进程号     ：快速停止Nginx<br>pkill -9 nginx          ：强制停止Nginx</p>
<p>启动nginx:<br>nginx -c /path/to/nginx.conf</p>
<p>平滑重启nginx：<br>kill -HUP 主进程号</p>
<a id="more"></a>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;nginx -s reload  ：修改配置后重新加载生效&lt;br&gt;nginx -s reopen  ：重新打开日志文件&lt;br&gt;nginx -t -c /path/to/nginx.conf 测试nginx配置文件是否正确&lt;/p&gt;
&lt;p&gt;关闭nginx：&lt;br&gt;nginx -s stop  :快速停止nginx&lt;br&gt;         quit  ：完整有序的停止nginx&lt;/p&gt;
&lt;p&gt;其他的停止nginx 方式：&lt;/p&gt;
&lt;p&gt;ps -ef | grep nginx&lt;/p&gt;
&lt;p&gt;kill -QUIT 主进程号     ：从容停止Nginx&lt;br&gt;kill -TERM 主进程号     ：快速停止Nginx&lt;br&gt;pkill -9 nginx          ：强制停止Nginx&lt;/p&gt;
&lt;p&gt;启动nginx:&lt;br&gt;nginx -c /path/to/nginx.conf&lt;/p&gt;
&lt;p&gt;平滑重启nginx：&lt;br&gt;kill -HUP 主进程号&lt;/p&gt;
    
    </summary>
    
      <category term="nginx" scheme="http://sunhao.win/categories/nginx/"/>
    
    
      <category term="nginx配置" scheme="http://sunhao.win/tags/nginx%E9%85%8D%E7%BD%AE/"/>
    
  </entry>
  
  <entry>
    <title>mysql2013错误</title>
    <link href="http://sunhao.win/articles/mysql-2013%E9%94%99%E8%AF%AF.html"/>
    <id>http://sunhao.win/articles/mysql-2013错误.html</id>
    <published>2017-05-09T02:42:21.000Z</published>
    <updated>2017-05-09T02:48:35.933Z</updated>
    
    <content type="html"><![CDATA[<p>mysql错误Lost connection to MySQL server at ‘reading initial communication packet’, system error: 0<br><img src="http://ojlt0g866.bkt.clouddn.com/blog/20170509/104541613.png" alt="mark"><br><img src="http://ojlt0g866.bkt.clouddn.com/blog/20170509/104641667.png" alt="mark"><br>默认绑定的是本地,所以把bind-address = 127.0.0.1注释掉就好了。<br>然后重启下服务器<br>/etc/init.d/mysql restart</p>
<a id="more"></a>
<p>如果忘记密码<br>可以添加<br>skip-grant-tables<br>忽略权限验证</p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;mysql错误Lost connection to MySQL server at ‘reading initial communication packet’, system error: 0&lt;br&gt;&lt;img src=&quot;http://ojlt0g866.bkt.clouddn.com/blog/20170509/104541613.png&quot; alt=&quot;mark&quot;&gt;&lt;br&gt;&lt;img src=&quot;http://ojlt0g866.bkt.clouddn.com/blog/20170509/104641667.png&quot; alt=&quot;mark&quot;&gt;&lt;br&gt;默认绑定的是本地,所以把bind-address = 127.0.0.1注释掉就好了。&lt;br&gt;然后重启下服务器&lt;br&gt;/etc/init.d/mysql restart&lt;/p&gt;
    
    </summary>
    
      <category term="mysql" scheme="http://sunhao.win/categories/mysql/"/>
    
    
      <category term="2013错误" scheme="http://sunhao.win/tags/2013%E9%94%99%E8%AF%AF/"/>
    
  </entry>
  
  <entry>
    <title>写给前端工程师的DNS基础知识</title>
    <link href="http://sunhao.win/articles/netwrok-dns.html"/>
    <id>http://sunhao.win/articles/netwrok-dns.html</id>
    <published>2017-05-05T06:47:39.000Z</published>
    <updated>2017-05-12T07:10:15.613Z</updated>
    
    <content type="html"><![CDATA[<h3 id="DNS"><a href="#DNS" class="headerlink" title="DNS"></a>DNS</h3><p>在工作中，经常切换本地和服务器，添加各种解析。遇到DNS引起的一些问题。发现网上资料很混乱，用心整理写了下，希望对大家有帮助。</p>
<p>DNS（Domain Name System，域名系统），最初，由于ip长且难记，通过ip访问网站不方便。。所以后来通过发明了DNS服务器，这个时候我们访问网站输入网站域名，DNS服务器就解析我们的域名为ip。这样我们实际访问的就是对应的ip地址啦。</p>
<p>抽象点DNS就是   一个记录ip地址的超级分布式数据库。</p>
<a id="more"></a>
<h3 id="根域和根域服务器"><a href="#根域和根域服务器" class="headerlink" title="根域和根域服务器"></a>根域和根域服务器</h3><p>首先我们要明白如何区分域，至于如何解析我们后面慢慢讲。</p>
<p>当我们输入www.sunhao.win访问网站。实际上是访问了不同的域。<br>其中”.”是DNS 命称空间，用来分割不同域,</p>
<p>www,sunhao,win分别代表不同的域。其实还有个域，跟在win后面，只是因为是域名系统默认的,所以这里不用写，这个就是根域。</p>
<p>意义上域名应该是这样。</p>
<pre><code>www.sunhao.win.根域
</code></pre><p>根域记录了所有win域(这一个位置的叫顶级域),它和sunhao(二级域),共同构成顶级域名sunhao.win</p>
<p>www(三级域)和sunhao.win叫二级域名www.sunhao.win</p>
<p>这里大家要明白sunhao.win和www.sunhao.win是两个不同的网址。</p>
<p>因为我们上网使用的UDP/TCP，UDP数据往往没有保障,但速度快,通常用于查询和响应，TCP由于多次验证，传输有保证，但速度慢，多用于主服务器和从服务器之间的传送。</p>
<p>因此我们DNS主要通过UDP。</p>
<p>当我们访问www.sunhao.win的时候,如果本地dns服务器没有记录，那么它就会向根服务器去请求地址。</p>
<p>也就是它会向根服务器请求win域的地址。然后通过win域继续向下请求。根域名服务器并不直接把待查询的域名直接解析出IP地址，而是告诉本地域名服务器下一步应当找哪一个顶级域名服务器进行查询。</p>
<p>所以根域名服务器很重要。假定所有的根域名服务器都瘫痪了，那么整个DNS系统就无法工作。</p>
<h3 id="顶级域和顶级域服务器"><a href="#顶级域和顶级域服务器" class="headerlink" title="顶级域和顶级域服务器"></a>顶级域和顶级域服务器</h3><p>例如www.sunhao.win</p>
<p>win所在的位置就是顶级域</p>
<p>域名只是逻辑概念，并不代表计算机所在的物理地点。据2006年12月统计，现在顶级域名TLD(Top Level Domain)已有265个，分为三大类：</p>
<p>(1)国家顶级域名nTLD：采用ISO3166的规定。如：cn代表中国，us代表美国，uk代表英国，等等。国家域名又常记为ccTLD(cc表示国家代码contry-code)。</p>
<p>(2)通用顶级域名gTLD：最常见的通用顶级域名有7个，即：com(公司企业)，net(网络服务机构)，org(非营利组织)，int(国际组织)，gov(美国的政府部门)，mil(美国的军事部门)。<br>(3)基础结构域名(infrastructure domain)：这种顶级域名只有一个，即arpa，用于反向域名解析，因此称为反向域名。</p>
<p>顶级域名服务器主要负责管理在该顶级域名服务器注册的二级域名。</p>
<p>###权威DNS和权威域名服务器</p>
<p>权威DNS服务器是经过上一级授权，对域名进行解析的服务器，同时它可以把解析授权转授给其他人。</p>
<p>例如，<br>在互联网上,谁售出的域名,就把域名授权给谁，比如sunhao.win是阿里售出的，所以权威服务器是阿里的dns解析服务器。(为了保障安全和保障一般权威DNS服务器都是俩)</p>
<p>dns9.hichina.com<br>dns10.hichina.com</p>
<p>但是由于业务我从后台调整解析到yunjiasu。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">;; AUTHORITY SECTION:</div><div class="line">sunhao.win.		2992	IN	NS	n563.ns.yunjiasu.com.</div><div class="line">sunhao.win.		2992	IN	NS	n3101.ns.yunjiasu.com.</div></pre></td></tr></table></figure>
<p>其中n563.ns.yunjiasu.com和n3101.ns.yunjiasu.com是sunhao.win的权威服务器。<br>由顶级域名win授权ns.yunjiasu.com.进行管理的。</p>
<p>当访问sunhao.win通过顶级域名解析后，顶级域名win就给用户说,你要访问sunhao.win是吧，你得去n563.ns.yunjiasu.com看看,它那记录了ip地址,不行就去n3101.ns.yunjiasu.com.再不行，你就自己报错把。^_^.</p>
<p>通俗点说,就是爸爸给孩子十块钱(这里指域名)，这十块钱,孩子可以自己花，也可以转给别人。拥有了控制十块钱的所有权限。简单点说,就是一旦把域名授权给我，授权给我的那部分，我做主。</p>
<h3 id="运营商DNS服务器和本地DNS服务器"><a href="#运营商DNS服务器和本地DNS服务器" class="headerlink" title="运营商DNS服务器和本地DNS服务器"></a>运营商DNS服务器和本地DNS服务器</h3><p>在实际上网中，我们不是直接连接根服务器，而是通过本地DNS服务器上网。</p>
<p>如果DNS设置不好，或者不对，会导致如我们qq能登陆，而页面无法浏览网页的症状、</p>
<p>在这，本地DNS主要指是指各地电信运营商提供的域名解析服务器。也就是我们在上网网卡里面你设置的DNS地址。当然也可以自己建设一个服务器。</p>
<p><img src="http://ojlt0g866.bkt.clouddn.com/blog/20170512/134034145.png" alt="mark"></p>
<p>当一个主机发出DNS查询请求时，这个查询请求报文就发送给本地域名服务器，本地服务器替我们进行DNS解析,我们得到的ip地址是由本地服务器返回的。</p>
<h3 id="查询"><a href="#查询" class="headerlink" title="查询"></a>查询</h3><p>我们了解了个个服务器,理一下常规DNS系统如何运作的吧</p>
<p>1，用户—&gt;本地递归服务器— &gt; 根权威服务器— &gt; COM权威服务器— &gt; X(X代表任意地址).COM权威服务器— &gt; 本地递归服务器— &gt;用户</p>
<p>2，用户—&gt;本地递归服务器— &gt; 缓存 — &gt;用户</p>
<p>在这我们要明白两点。</p>
<p>一、递归查询:主机向本地域名服务器的查询一般都是采用递归查询。所谓递归查询就是：如果主机所询问的本地域名服务器不知道被查询的域名的IP地址，那么本地域名服务器就以DNS客户的身份，向其它根域名服务器继续发出查询请求报文(即替主机继续查询)，而不是让主机自己进行下一步查询。因此，递归查询返回的查询结果或者是所要查询的IP地址，或者是报错，表示无法查询到所需的IP地址。</p>
<p>简单说 就是说我们请求的地址  必须返回一个准确的ip地址，没有就向别的地址查询，然后返回给我们一个准确的ip地址。我们的本地服务器就是递归服务器。</p>
<p>二、迭代查询:本地域名服务器向根域名服务器的查询的迭代查询。迭代查询的特点：当根域名服务器收到本地域名服务器发出的迭代查询请求报文时，要么给出所要查询的IP地址，要么告诉本地服务器：“你下一步应当向哪一个域名服务器进行查询”。然后让本地服务器进行后续的查询。根域名服务器通常是把自己知道的顶级域名服务器的IP地址告诉本地域名服务器，让本地域名服务器再向顶级域名服务器查询。顶级域名服务器在收到本地域名服务器的查询请求后，要么给出所要查询的IP地址，要么告诉本地服务器下一步应当向哪一个权限域名服务器进行查询。最后，知道了所要解析的IP地址或报错，然后把这个结果返回给发起查询的主机。</p>
<p>这里由各级服务器进行的就是迭代查询，自身不返回ip，而是返回给下一级的DNS服务器地址。</p>
<p>实际一般本地DNS访问量巨大，会有一个前置的F5服务器，用于分发给后缀的服务器实现负载均衡。同时服务器会根据设置会缓存一段时间地址。所以有时候我们在服务器改完DNS，有时候会等一段时间，才能访问到新的地址。</p>
<h3 id="解析记录"><a href="#解析记录" class="headerlink" title="解析记录"></a>解析记录</h3><p>域名解析记录A、CNAME、MX、NS、TXT、AAAA、SRV、显性URL、隐形URL含义</p>
<ol>
<li><p>A记录：解析域名到指定ip</p>
</li>
<li><p>CNAME记录（Canonical Name 别名指向）：解析域名到域名</p>
</li>
<li><p>MX记录：指向一个邮件服务器，用于电子邮件系统发邮件时根据收信人的地址后缀来定位邮件服务器。</p>
</li>
<li><p>NS记录：解析服务器记录。用来表明由哪台服务器对该域名进行解析，这里的NS记录只对子域名生效。<br>优先级：NS记录优先于A记录。即，如果一个主机地址同时存在NS记录和A记录，则A记录不生效。这里的NS记录只对子域名生效。</p>
</li>
<li><p>TXT记录：为某个主机名或域名设置联系信息，如：<br>admin IN TXT “管理员, 电话： 1000000000”</p>
</li>
<li><p>AAAA记录(AAAA record)：是用来将域名解析到IPv6地址的DNS记录。用户可以将一个域名解析到IPv6地址上，也可以将子域名解析到IPv6地址上。</p>
</li>
<li><p>SRV记录：一般是为Microsoft的活动目录设置时的应用。</p>
</li>
<li><p>显性URL记录：访问域名时，会自动跳转到所指的另一个网络地址（URL），此时在浏览器地址栏中显示的是跳转的地址。</p>
</li>
<li><p>隐形URL记录：访问域名时，会自动跳转到所指的另一个网络地址（URL），此时在浏览器地址栏中显示的是原域名地址。</p>
</li>
</ol>
<h3 id="应答"><a href="#应答" class="headerlink" title="应答"></a>应答</h3><p>权威应答</p>
<p>由权威服务器区域直接返回的应答地址</p>
<p>非权威应答</p>
<p>由缓存或者其他服务器返回的地址</p>
<!--### 智能dns与cdn加速-->
<h3 id="TTL值和缓存"><a href="#TTL值和缓存" class="headerlink" title="TTL值和缓存"></a>TTL值和缓存</h3><p>假如我们每次都发送一次DNS请求,那么服务器的压力会相当大，但是服务器的ip地址一般会经常变，所以实际我们都设置TTL把DNS缓存到本地。</p>
<p>什么是域名的TTL值？<br>TTL(Time- To-Live)，简单的说它就是返回的记录在DNS服务器上保留的时间，就是TTL值。<br><img src="http://ojlt0g866.bkt.clouddn.com/blog/20170505/155336775.png" alt="mark"></p>
<p>DNS会将最终域名解析的结果缓存至本地。分为两种浏览器缓存和操作系统(OS)缓存。</p>
<p>在浏览器中访问的时候，会优先访问浏览器缓存，如果访问指定域名,没有命中返回,则访问OS缓存。最后再次访问dns服务器。</p>
<p>所以我们在调试的时候，更换了本地hosts仍然访问的是旧地址,那么就等一会吧。</p>
<p><img src="http://ojlt0g866.bkt.clouddn.com/blog/20170505/153318984.png" alt="mark"></p>
<p>首先我们要解决的是浏览器dns缓存,我们可以看到chrome会自动缓存70s dns。</p>
<h3 id="hosts"><a href="#hosts" class="headerlink" title="hosts"></a>hosts</h3><p>在DNS系统之前，对应ip都是保存在hosts文件之中，现在系统仍然保留它。</p>
<p>实际通过浏览器访问，会先查询浏览器dns缓存，再查询hosts里面是否有记录</p>
<p><img src="http://ojlt0g866.bkt.clouddn.com/blog/20170512/144511980.png" alt="mark"></p>
<p>一般win系么Hosts文件就在C:\WINDOWS\system32\drivers\etc中</p>
<p>通过hosts我们可以把域名改成本地的地址，进行调试开发。</p>
<p>对于经常访问的网站，也可以直接设置到hosts里，加快访问速度。</p>
<!--### 域名迁移  换DNS服务商-->
<h3 id="sunhao-win解析过程分析"><a href="#sunhao-win解析过程分析" class="headerlink" title="sunhao.win解析过程分析"></a>sunhao.win解析过程分析</h3><p>最后我们看下用dig +trace 跟踪的全部解析过程</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div></pre></td><td class="code"><pre><div class="line">[root@sunhao ~]# dig +trace www.sunhao.win</div><div class="line"></div><div class="line">; &lt;&lt;&gt;&gt; DiG 9.8.2rc1-RedHat-9.8.2-0.37.rc1.el6 &lt;&lt;&gt;&gt; +trace www.sunhao.win</div><div class="line">;; global options: +cmd</div><div class="line">.			12674	IN	NS	e.root-servers.net.</div><div class="line">.			12674	IN	NS	i.root-servers.net.</div><div class="line">.			12674	IN	NS	h.root-servers.net.</div><div class="line">.			12674	IN	NS	k.root-servers.net.</div><div class="line">.			12674	IN	NS	d.root-servers.net.</div><div class="line">.			12674	IN	NS	l.root-servers.net.</div><div class="line">.			12674	IN	NS	a.root-servers.net.</div><div class="line">.			12674	IN	NS	c.root-servers.net.</div><div class="line">.			12674	IN	NS	m.root-servers.net.</div><div class="line">.			12674	IN	NS	g.root-servers.net.</div><div class="line">.			12674	IN	NS	b.root-servers.net.</div><div class="line">.			12674	IN	NS	f.root-servers.net.</div><div class="line">.			12674	IN	NS	j.root-servers.net.</div><div class="line">;; Received 492 bytes from 211.161.46.85#53(211.161.46.85) in 42 ms</div><div class="line"></div><div class="line">win.			172800	IN	NS	ns1.dns.nic.win.</div><div class="line">win.			172800	IN	NS	ns6.dns.nic.win.</div><div class="line">win.			172800	IN	NS	ns3.dns.nic.win.</div><div class="line">win.			172800	IN	NS	ns2.dns.nic.win.</div><div class="line">win.			172800	IN	NS	ns5.dns.nic.win.</div><div class="line">win.			172800	IN	NS	ns4.dns.nic.win.</div><div class="line">;; Received 412 bytes from 192.36.148.17#53(192.36.148.17) in 191 ms</div><div class="line"></div><div class="line">sunhao.win.		3600	IN	NS	n563.ns.yunjiasu.com.</div><div class="line">sunhao.win.		3600	IN	NS	n3101.ns.yunjiasu.com.</div><div class="line">;; Received 86 bytes from 156.154.145.182#53(156.154.145.182) in 2415 ms</div><div class="line"></div><div class="line">www.sunhao.win.		300	IN	A	162.159.211.33</div><div class="line">www.sunhao.win.		300	IN	A	162.159.210.33</div><div class="line">;; Received 92 bytes from 220.181.111.112#53(220.181.111.112) in 6 ms</div></pre></td></tr></table></figure>
<p>.就是一个是说的根域。NS就是指定该域名由哪个DNS服务器来进行解析。</p>
<p>我们可以清晰的看到第一步先从13台dns服务器，然是顶级域win,最后权威域sunhao.win。<br>查到地址在162.159.211.33和162.159.210.33上。最后的是A记录。不再是NS了哦。</p>
]]></content>
    
    <summary type="html">
    
      &lt;h3 id=&quot;DNS&quot;&gt;&lt;a href=&quot;#DNS&quot; class=&quot;headerlink&quot; title=&quot;DNS&quot;&gt;&lt;/a&gt;DNS&lt;/h3&gt;&lt;p&gt;在工作中，经常切换本地和服务器，添加各种解析。遇到DNS引起的一些问题。发现网上资料很混乱，用心整理写了下，希望对大家有帮助。&lt;/p&gt;
&lt;p&gt;DNS（Domain Name System，域名系统），最初，由于ip长且难记，通过ip访问网站不方便。。所以后来通过发明了DNS服务器，这个时候我们访问网站输入网站域名，DNS服务器就解析我们的域名为ip。这样我们实际访问的就是对应的ip地址啦。&lt;/p&gt;
&lt;p&gt;抽象点DNS就是   一个记录ip地址的超级分布式数据库。&lt;/p&gt;
    
    </summary>
    
      <category term="netwrok" scheme="http://sunhao.win/categories/netwrok/"/>
    
    
      <category term="dns" scheme="http://sunhao.win/tags/dns/"/>
    
  </entry>
  
  <entry>
    <title>fg、bg、jobs、&amp;、nohup、ctrl+z、ctrl+c、screen命令</title>
    <link href="http://sunhao.win/articles/linux-bg-fg-jobs-screen.html"/>
    <id>http://sunhao.win/articles/linux-bg-fg-jobs-screen.html</id>
    <published>2017-05-04T02:10:17.000Z</published>
    <updated>2017-05-04T09:25:20.233Z</updated>
    
    <content type="html"><![CDATA[<p>一、&amp;</p>
<p>加在一个命令的最后，可以把这个命令放到后台执行，如</p>
<p>watch  -n 10 sh  test.sh  &amp;  #每10s在后台执行一次test.sh脚本</p>
<p>二、ctrl + z</p>
<p>可以将一个正在前台执行的命令放到后台，并且处于暂停状态。</p>
<p>三、jobs</p>
<p>查看当前有多少在后台运行的命令</p>
<p>jobs -l选项可显示所有任务的PID，jobs的状态可以是running, stopped, Terminated。但是如果任务被终止了（kill），shell从当前的shell环境已知的列表中删除任务的进程标识。</p>
<a id="more"></a>
<p>四、fg</p>
<p>将后台中的命令调至前台继续运行。如果后台中有多个命令，可以用fg %jobnumber（是命令编号，不是进程号）将选中的命令调出。</p>
<p>五、bg</p>
<p>将一个在后台暂停的命令，变成在后台继续执行。如果后台中有多个命令，可以用bg %jobnumber将选中的命令调出。</p>
<p>六、kill</p>
<p>法子1：通过jobs命令查看job号（假设为num），然后执行kill %num</p>
<p>法子2：通过ps命令查看job的进程号（PID，假设为pid），然后执行kill pid</p>
<p>前台进程的终止：Ctrl+c</p>
<p>七、nohup</p>
<p>如果让程序始终在后台执行，即使关闭当前的终端也执行（之前的&amp;做不到），这时候需要nohup。该命令可以在你退出帐户/</p>
<p>关闭终端之后继续运行相应的进程。关闭中断后，在另一个终端jobs已经无法看到后台跑得程序了，此时利用ps（进程查看命令）</p>
<p>ps -aux | grep “test.sh”  #a:显示所有程序 u:以用户为主的格式来显示 x:显示所有程序，不以终端机来区分</p>
<p>进程的终止： </p>
<p>后台进程的终止：</p>
<p>一、使用Screen创建一个Session</p>
<p>　　screen -S sessionName 注：sessionName是要删除的session名字</p>
<p>二、结束一个Screen创建的session</p>
<p>1、首先使用screen -ls命令查看全部session列表</p>
<p>2、使用screen -S sessionName -X quit, 注：sessionName是要删除的session名字</p>
<p>三、恢复一个Screen的session</p>
<p>1、Screen -r sessionName</p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;一、&amp;amp;&lt;/p&gt;
&lt;p&gt;加在一个命令的最后，可以把这个命令放到后台执行，如&lt;/p&gt;
&lt;p&gt;watch  -n 10 sh  test.sh  &amp;amp;  #每10s在后台执行一次test.sh脚本&lt;/p&gt;
&lt;p&gt;二、ctrl + z&lt;/p&gt;
&lt;p&gt;可以将一个正在前台执行的命令放到后台，并且处于暂停状态。&lt;/p&gt;
&lt;p&gt;三、jobs&lt;/p&gt;
&lt;p&gt;查看当前有多少在后台运行的命令&lt;/p&gt;
&lt;p&gt;jobs -l选项可显示所有任务的PID，jobs的状态可以是running, stopped, Terminated。但是如果任务被终止了（kill），shell从当前的shell环境已知的列表中删除任务的进程标识。&lt;/p&gt;
    
    </summary>
    
      <category term="linux" scheme="http://sunhao.win/categories/linux/"/>
    
    
      <category term="fg" scheme="http://sunhao.win/tags/fg/"/>
    
      <category term="bg" scheme="http://sunhao.win/tags/bg/"/>
    
      <category term="jobs" scheme="http://sunhao.win/tags/jobs/"/>
    
      <category term="screen" scheme="http://sunhao.win/tags/screen/"/>
    
  </entry>
  
  <entry>
    <title>respberry树莓派 无线网络配置</title>
    <link href="http://sunhao.win/articles/respberry-wpanetwork.html"/>
    <id>http://sunhao.win/articles/respberry-wpanetwork.html</id>
    <published>2017-05-02T07:56:14.000Z</published>
    <updated>2017-05-02T07:59:46.240Z</updated>
    
    <content type="html"><![CDATA[<p>执行命令: sudo iwlist wlan0 scan , 看看能否手动扫描周围的ESSID.</p>
<h3 id="无线配置"><a href="#无线配置" class="headerlink" title="无线配置"></a>无线配置</h3><p>修改配置文件: sudo vim /etc/network/interfaces, 如果需要自动IP, 增加如下:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"># wifi (dhcp config) :</div><div class="line">auto wlan0</div><div class="line">allow-hotplug wlan0</div><div class="line">iface wlan0 inet dhcp</div><div class="line">wpa-conf /etc/wpa_supplicant/wpa_supplicant.conf</div></pre></td></tr></table></figure>
<p>如果需要固定IP, 增加的内容如下:</p>
<a id="more"></a>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">auto wlan0</div><div class="line">iface wlan0 inet static</div><div class="line">wpa-conf /etc/wpa_supplicant/wpa_supplicant.conf</div><div class="line">address 192.168.1.12</div><div class="line">netmask 255.255.255.0</div><div class="line">gateway 192.168.1.1</div></pre></td></tr></table></figure>
<p>编辑/etc/wpa_supplicant/wpa_supplicant.conf, 增加如下几行:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">network=&#123;</div><div class="line">    ssid=&quot;ssid1&quot;</div><div class="line">    psk=&quot;密码&quot;</div><div class="line">&#125;</div><div class="line">network=&#123;</div><div class="line">    ssid=&quot;ssid2&quot;</div><div class="line">    psk=&quot;密码&quot;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>这里存的是明文密码, 如果需要存储加密后的密码, 执行命令wpa_passphrase ssid password, 替换上面的psk密码.<br>wpa_supplicant.conf里面更多参数详情, 请参考man手册链接, 上面的配置能应付大多数路由器了.</p>
<p>重启wlan0</p>
<p>重启无线网卡: sudo ifdown wlan0 and then  sudo ifup wlan0<br>然后运行ifconfig wlan0 查看无线网卡是否获能够取到了IP.<br>如果固定ip  最好重启 reboot  输入密码</p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;执行命令: sudo iwlist wlan0 scan , 看看能否手动扫描周围的ESSID.&lt;/p&gt;
&lt;h3 id=&quot;无线配置&quot;&gt;&lt;a href=&quot;#无线配置&quot; class=&quot;headerlink&quot; title=&quot;无线配置&quot;&gt;&lt;/a&gt;无线配置&lt;/h3&gt;&lt;p&gt;修改配置文件: sudo vim /etc/network/interfaces, 如果需要自动IP, 增加如下:&lt;/p&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;# wifi (dhcp config) :&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;auto wlan0&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;allow-hotplug wlan0&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;iface wlan0 inet dhcp&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;wpa-conf /etc/wpa_supplicant/wpa_supplicant.conf&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;如果需要固定IP, 增加的内容如下:&lt;/p&gt;
    
    </summary>
    
      <category term="respberry" scheme="http://sunhao.win/categories/respberry/"/>
    
    
      <category term="无线网络配置" scheme="http://sunhao.win/tags/%E6%97%A0%E7%BA%BF%E7%BD%91%E7%BB%9C%E9%85%8D%E7%BD%AE/"/>
    
  </entry>
  
  <entry>
    <title>linux-source</title>
    <link href="http://sunhao.win/articles/linux-source.html"/>
    <id>http://sunhao.win/articles/linux-source.html</id>
    <published>2017-05-02T02:47:55.000Z</published>
    <updated>2017-05-02T02:57:10.970Z</updated>
    
    <content type="html"><![CDATA[<p>source: usage: source filename [arguments]</p>
<p>source命令：<br>source命令也称为“点命令”，也就是一个点符号（.）,是bash的内部命令。<br>功能：使Shell读入指定的Shell程序文件并依次执行文件中的所有语句<br>source命令通常用于重新执行刚修改的初始化文件，使之立即生效，而不必注销并重新登录。<br>用法：<br>source filename 或 . filename<br>source命令(从 C Shell 而来)是bash shell的内置命令;点命令(.)，就是个点符号(从Bourne Shell而来)是source的另一名称。<br><a id="more"></a></p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;source: usage: source filename [arguments]&lt;/p&gt;
&lt;p&gt;source命令：&lt;br&gt;source命令也称为“点命令”，也就是一个点符号（.）,是bash的内部命令。&lt;br&gt;功能：使Shell读入指定的Shell程序文件并依次执行文件中的所有语句&lt;br&gt;source命令通常用于重新执行刚修改的初始化文件，使之立即生效，而不必注销并重新登录。&lt;br&gt;用法：&lt;br&gt;source filename 或 . filename&lt;br&gt;source命令(从 C Shell 而来)是bash shell的内置命令;点命令(.)，就是个点符号(从Bourne Shell而来)是source的另一名称。&lt;br&gt;
    
    </summary>
    
      <category term="linux" scheme="http://sunhao.win/categories/linux/"/>
    
    
      <category term="source" scheme="http://sunhao.win/tags/source/"/>
    
  </entry>
  
  <entry>
    <title>/bin,/sbin,/usr/bin,/usr/sbin区别</title>
    <link href="http://sunhao.win/articles/linux-diff-sbin-bin.html"/>
    <id>http://sunhao.win/articles/linux-diff-sbin-bin.html</id>
    <published>2017-05-02T01:48:34.000Z</published>
    <updated>2017-05-02T02:13:59.255Z</updated>
    
    <content type="html"><![CDATA[<h2 id="bin-sbin-usr-bin-usr-sbin区别"><a href="#bin-sbin-usr-bin-usr-sbin区别" class="headerlink" title="/bin,/sbin,/usr/bin,/usr/sbin区别"></a>/bin,/sbin,/usr/bin,/usr/sbin区别</h2><p>/ : this is root directory             root 用户根目录</p>
<p>/bin : commandsin this dir are all system installed user commands   系统的一些指令</p>
<p>/sbin: commands in this dir are all system installedsuper user commands<br>超级用户指令系统管理命令，这里存放的是系统管理员使用的管理程序 </p>
<p>/usr/bin: usercommands for applications 后期安装的一些软件的运行脚本</p>
<p>/usr/sbin:super user commands for applications 超级用户的一些管理程序</p>
<p>/usr/X11R6/bin: X application user commands</p>
<p>/usr/X11R6/sbin: X application super usercommands<br><a id="more"></a></p>
<p>Linux中的某些重要的目录：<br>    •主目录：/root、/home/username<br>    •用户可执行文件：/bin、/usr/bin、/usr/local/bin<br>    •系统可执行文件：/sbin、/usr/sbin、/usr/local/sbin<br>    •其他挂载点：/media、/mnt<br>    •配置：/etc<br>    •临时文件：/tmp<br>    •内核和Bootloader：/boot<br>    •服务器数据：/var、/srv<br>    •系统信息：/proc、/sys<br>    •共享库：/lib、/usr/lib、/usr/local/lib</p>
<pre><code>每个用户都拥有一个主目录。所有用户的个人文件（配置、数据甚至应用程序）都放在其中。
根的主目录为/root。大多数非根主目录包含在/home 树中，通常以用户命名。
重要的二进制位于 /bin（用户二进制）以及 /sbin（系统二进制）中。
不重要的二进制（如图形环境或Office 工具）安装在/usr/bin 和 /usr/sbin中。进行这种分隔是为了尽可能地缩小根分区。使用源代码编译的软件通常位于 /usr/local/bin 和/usr/local/sbin中。
</code></pre><h3 id="传统上的常规做法是："><a href="#传统上的常规做法是：" class="headerlink" title="传统上的常规做法是："></a>传统上的常规做法是：</h3><p>系统级的组件放在/bin、/lib；</p>
<p>根用户才能访问的放在/sbin；</p>
<p>系统repository提供的应用程序放在/usr/bin、/usr/lib；</p>
<p>用户自己编译的放在/usr/local/XXX。</p>
<p>现在有一些变化，在大约两年前，大量Linux系统都将/bin、/lib弄成/usr/bin、/usr/lib的符号链接。</p>
<p>此外，不同系统还会有很多的细微区别，比如Redhat系喜欢把32位的库放在/lib、/usr/lib，64位的库放在/lib64、/usr/</p>
<p>lib64，而Debian系喜欢把平台相关的那层名字放在/lib、/usr/lib的子目录里，比如/usr/lib/x86_64-linux-gnu/</p>
<p>。然后，各种配置文件的文件名、路径也会有区别，比如ssh服务器的配置文件可能叫/etc/ssh/sshd.conf，也可能叫/etc/ssh/sshd_config。。。</p>
<p>分成三块的最早的渊源，据说是这样的：</p>
<p>Unix开发者的机器的硬盘不够了，新加了一块，挂在/usr上；</p>
<p>又TM不够了，再加一块，挂在/usr/local上；</p>
<p>不知怎么，就变成规范了。。。。</p>
]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;bin-sbin-usr-bin-usr-sbin区别&quot;&gt;&lt;a href=&quot;#bin-sbin-usr-bin-usr-sbin区别&quot; class=&quot;headerlink&quot; title=&quot;/bin,/sbin,/usr/bin,/usr/sbin区别&quot;&gt;&lt;/a&gt;/bin,/sbin,/usr/bin,/usr/sbin区别&lt;/h2&gt;&lt;p&gt;/ : this is root directory             root 用户根目录&lt;/p&gt;
&lt;p&gt;/bin : commandsin this dir are all system installed user commands   系统的一些指令&lt;/p&gt;
&lt;p&gt;/sbin: commands in this dir are all system installedsuper user commands&lt;br&gt;超级用户指令系统管理命令，这里存放的是系统管理员使用的管理程序 &lt;/p&gt;
&lt;p&gt;/usr/bin: usercommands for applications 后期安装的一些软件的运行脚本&lt;/p&gt;
&lt;p&gt;/usr/sbin:super user commands for applications 超级用户的一些管理程序&lt;/p&gt;
&lt;p&gt;/usr/X11R6/bin: X application user commands&lt;/p&gt;
&lt;p&gt;/usr/X11R6/sbin: X application super usercommands&lt;br&gt;
    
    </summary>
    
      <category term="linux" scheme="http://sunhao.win/categories/linux/"/>
    
    
      <category term="sbin" scheme="http://sunhao.win/tags/sbin/"/>
    
      <category term="bin" scheme="http://sunhao.win/tags/bin/"/>
    
  </entry>
  
  <entry>
    <title>反向代理 和 正向代理区别</title>
    <link href="http://sunhao.win/articles/php-proxy.html"/>
    <id>http://sunhao.win/articles/php-proxy.html</id>
    <published>2017-04-27T09:00:38.000Z</published>
    <updated>2017-04-28T06:40:20.811Z</updated>
    
    <content type="html"><![CDATA[<p>一个是代理客户端，为客户端收发请求，使真实客户端对服务器不可见。<br>一个是代理服务器，为服务器收发请求，使真实服务器对客户端不可见。<br>简单点说<br>代理的目的本身都是为了隐藏自己真实的地址。</p>
<p>正向代理,是客户端用的,因为符合正常的网络请求，所以叫正向代理。<br>而反向代理，是服务器用的，所以叫反向代理。</p>
<a id="more"></a>
<p>A同学在大众创业、万众创新的大时代背景下开启他的创业之路，目前他遇到的最大的一个问题就是启动资金，于是他决定去找马云爸爸借钱，可想而知，最后碰一鼻子灰回来了，情急之下，他想到一个办法，找关系开后门，经过一番消息打探，原来A同学的大学老师王老师是马云的同学，于是A同学找到王老师，托王老师帮忙去马云那借500万过来，当然最后事成了。不过马云并不知道这钱是A同学借的，马云是借给王老师的，最后由王老师转交给A同学。这里的王老师在这个过程中扮演了一个非常关键的角色，就是代理，也可以说是正向代理，王老师代替A同学办这件事，这个过程中，真正借钱的人是谁，马云是不知道的，这点非常关键。   我们常说的代理也就是只正向代理，正向代理的过程，它隐藏了真实的请求客户端，服务端不知道真实的客户端是谁，客户端请求的服务都被代理服务器代替来请求，某些科学上网工具扮演的就是典型的正向代理角色。用浏览器访问 <a href="http://www.google.com" target="_blank" rel="external">http://www.google.com</a> 时，被残忍的block，于是你可以在国外搭建一台代理服务器，让代理帮我去请求google.com，代理把请求返回的相应结构再返回给我。</p>
<p>client &lt;==&gt; proxy &lt;==&gt;server</p>
<p>这里client知道server地址,但server不知道client地址  只是用proxy做了个请求.</p>
<p>大家都有过这样的经历，拨打10086客服电话，可能一个地区的10086客服有几个或者几十个，你永远都不需要关心在电话那头的是哪一个，叫什么，男的，还是女的，漂亮的还是帅气的，你都不关心，你关心的是你的问题能不能得到专业的解答，你只需要拨通了10086的总机号码，电话那头总会有人会回答你，只是有时慢有时快而已。那么这里的10086总机号码就是我们说的反向代理。客户不知道真正提供服务人的是谁。   反向代理隐藏了真实的服务端，当我们请求 www.baidu.com 的时候，就像拨打10086一样，背后可能有成千上万台服务器为我们服务，但具体是哪一台，你不知道，也不需要知道，你只需要知道反向代理服务器是谁就好了，www.baidu.com 就是我们的反向代理服务器，反向代理服务器会帮我们把请求转发到真实的服务器那里去。Nginx就是性能非常好的反向代理服务器，用来做负载均衡。</p>
<p>client &lt;==&gt; proxy &lt;==&gt; serverA or serverB</p>
<p>这里客户端只知道proxy   具体哪个服务器内容,是proxy分配的</p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;一个是代理客户端，为客户端收发请求，使真实客户端对服务器不可见。&lt;br&gt;一个是代理服务器，为服务器收发请求，使真实服务器对客户端不可见。&lt;br&gt;简单点说&lt;br&gt;代理的目的本身都是为了隐藏自己真实的地址。&lt;/p&gt;
&lt;p&gt;正向代理,是客户端用的,因为符合正常的网络请求，所以叫正向代理。&lt;br&gt;而反向代理，是服务器用的，所以叫反向代理。&lt;/p&gt;
    
    </summary>
    
      <category term="php" scheme="http://sunhao.win/categories/php/"/>
    
    
      <category term="php" scheme="http://sunhao.win/tags/php/"/>
    
      <category term="proxy" scheme="http://sunhao.win/tags/proxy/"/>
    
  </entry>
  
  <entry>
    <title>Unicode 和 UTF-8 有何区别？</title>
    <link href="http://sunhao.win/articles/soft-unicode-utf8.html"/>
    <id>http://sunhao.win/articles/soft-unicode-utf8.html</id>
    <published>2017-04-26T08:53:56.000Z</published>
    <updated>2017-04-26T08:56:59.104Z</updated>
    
    <content type="html"><![CDATA[<p>很久很久以前，有一群人，他们决定用8个可以开合的晶体管来组合成不同的状态，以表示世界上的万物。他们看到8个开关状态是好的，于是他们把这称为”字节“。再后来，他们又做了一些可以处理这些字节的机器，机器开动了，可以用字节来组合出很多状态，状态开始变来变去。他们看到这样是好的，于是它们就这机器称为”计算机“。开始计算机只在美国用。八位的字节一共可以组合出256(2的8次方)种不同的状态。<br><a id="more"></a></p>
<p>他们把其中的编号从0开始的32种状态分别规定了特殊的用途，一但终端、打印机遇上约定好的这些字节被传过来时，就要做一些约定的动作。遇上0×10,<br>终端就换行，遇上0×07, 终端就向人们嘟嘟叫，例好遇上0x1b,<br>打印机就打印反白的字，或者终端就用彩色显示字母。他们看到这样很好，于是就把这些0×20以下的字节状态称为”控制码”。他们又把所有的空<br>格、标点符号、数字、大小写字母分别用连续的字节状态表示，一直编到了第127号，这样计算机就可以用不同字节来存储英语的文字了。大家看到这样，都感觉<br> 很好，于是大家都把这个方案叫做 ANSI 的”Ascii”编码（American Standard Code for Information Interchange，美国信息互换标准代码）。当时世界上所有的计算机都用同样的ASCII方案来保存英文文字。后来，就像建造巴比伦塔一样，世界各地的都开始使用计算机，但是很多国家用的不是英文，他们的字母里有许多是ASCII里没有的，为了可以在计算机<br>保存他们的文字，他们决定采用<br>127号之后的空位来表示这些新的字母、符号，还加入了很多画表格时需要用下到的横线、竖线、交叉等形状，一直把序号编到了最后一个状态255。从128<br> 到255这一页的字符集被称”扩展字符集“。从此之后，贪婪的人类再没有新的状态可以用了，美帝国主义可能没有想到还有第三世界国家的人们也希望可以用到计算机吧！等中国人们得到计算机时，已经没有可以利用的字节状态来表示汉字，况且有6000多个常用汉字需要保存呢。但是这难不倒智慧的中国人民，我们不客气<br>地把那些127号之后的奇异符号们直接取消掉,<br>规定：一个小于127的字符的意义与原来相同，但两个大于127的字符连在一起时，就表示一个汉字，前面的一个字节（他称之为高字节）从0xA1用到<br>0xF7，后面一个字节（低字节）从0xA1到0xFE，这样我们就可以组合出大约7000多个简体汉字了。在这些编码里，我们还把数学符号、罗马希腊的<br>字母、日文的假名们都编进去了，连在 ASCII<br>里本来就有的数字、标点、字母都统统重新编了两个字节长的编码，这就是常说的”全角”字符，而原来在127号以下的那些就叫”半角”字符了。<br>中国人民看到这样很不错，于是就把这种汉字方案叫做 “GB2312“。GB2312 是对 ASCII 的中文扩展。但是中国的汉字太多了，我们很快就就发现有许多人的人名没有办法在这里打出来，特别是某些很会麻烦别人的国家领导人。于是我们不得不继续把<br>GB2312 没有用到的码位找出来老实不客气地用上。<br>后来还是不够用，于是干脆不再要求低字节一定是127号之后的内码，只要第一个字节是大于127就固定表示这是一个汉字的开始，不管后面跟的是不是扩展字<br>符集里的内容。结果扩展之后的编码方案被称为 GBK 标准，GBK包括了GB2312 的所有内容，同时又增加了近20000个新的汉字（包括繁体字）和符号。 后来少数民族也要用电脑了，于是我们再扩展，又加了几千个新的少数民族的字，GBK扩成了 GB18030。从此之后，中华民族的文化就可以在计算机时代中传承了。 中国的程序员们看到这一系列汉字编码的标准是好的，于是通称他们叫做 “DBCS“（Double<br> Byte Charecter Set<br>双字节字符集）。在DBCS系列标准里，最大的特点是两字节长的汉字字符和一字节长的英文字符并存于同一套编码方案里，因此他们写的程序为了支持中文处<br>理，必须要注意字串里的每一个字节的值，如果这个值是大于127的，那么就认为一个双字节字符集里的字符出现了。那时候凡是受过加持，会编程的计算机僧侣<br> 们都要每天念下面这个咒语数百遍： “一个汉字算两个英文字符！一个汉字算两个英文字符……”因为当时各个国家都像中国这样搞出一套自己的编码标准，结果互相之间谁也不懂谁的编码，谁也不支持别人的编码，连大陆和台湾这样只相隔了150海<br>里，使用着同一种语言的兄弟地区，也分别采用了不同的 DBCS<br>编码方案——当时的中国人想让电脑显示汉字，就必须装上一个”汉字系统”，专门用来处理汉字的显示、输入的问题，但是那个台湾的愚昧封建人士写的算命程序<br>就必须加装另一套支持 BIG5<br>编码的什么”倚天汉字系统”才可以用，装错了字符系统，显示就会乱了套！这怎么办？而且世界民族之林中还有那些一时用不上电脑的穷苦人民，他们的文字又怎<br>么办？ 真是计算机的巴比伦塔命题啊！正在这时，大天使加百列及时出现了——一个叫 ISO<br>（国际标谁化组织）的国际组织决定着手解决这个问题。他们采用的方法很简单：废了所有的地区性编码方案，重新搞一个包括了地球上所有文化、所有字母和符号<br> 的编码！他们打算叫它”Universal Multiple-Octet Coded Character Set”，简称 UCS, 俗称 “unicode“。<br>unicode开始制订时，计算机的存储器容量极大地发展了，空间再也不成为问题了。于是 ISO<br>就直接规定必须用两个字节，也就是16位来统一表示所有的字符，对于ASCII里的那些“半角”字符，unicode包持其原编码不变，只是将其长度由原<br>来的8位扩展为16位，而其他文化和语言的字符则全部重新统一编码。由于”半角”英文符号只需要用到低8位，所以其高8位永远是0，因此这种大气的方案在<br>保存英文文本时会多浪费一倍的空间。这时候，从旧社会里走过来的程序员开始发现一个奇怪的现象：他们的strlen函数靠不住了，一个汉字不再是相当于两个字符了，而是一个！是的，从unicode开始，无论是半角的英文字母，还是全角的汉字，它们都是统一的”一个字符“！同时，也都是统一的”两个字节“，请注意”字符”和”字节”两个术语的不同，“字节”是一个8位的物理存贮单元，而“字符”则是一个文化相关的符号。在unicode中，一个字符就是两个字节。一个汉字算两个英文字符的时代已经快过去了。unicode同样也不完美，这里就有两个的问题，一个是，如何才能区别unicode和ascii？计算机怎么知道三个字节表示一个符号，而不是<br>分别表示三个符号呢？第二个问题是，我们已经知道，英文字母只用一个字节表示就够了，如果unicode统一规定，每个符号用三个或四个字节表示，那么每<br>个英文字母前都必然有二到三个字节是0，这对于存储空间来说是极大的浪费，文本文件的大小会因此大出二三倍，这是难以接受的。unicode在很长一段时间内无法推广，直到互联网的出现，为解决unicode如何在网络上传输的问题，于是面向传输的众多 UTF（UCS Transfer Format）标准出现了，顾名思义，UTF-8就是每次8个位传输数据，而UTF-16就是每次16个位。UTF-8就是在互联网上使用最广的一种unicode的实现方式，这是为传输而设计的编码，并使编码无国界，这样就可以显示全世界上所有文化的字符了。UTF-8最大的一个特点，就是它是一种变长的编码方式。它可以使用1~4个字节表示一个符号，根据不同的符号而变化字节长度，当字符在ASCII<br>码的范围时，就用一个字节表示，保留了ASCII字符一个字节的编码做为它的一部分，注意的是unicode一个中文字符占2个字节，而UTF-8一个中<br>文字符占3个字节）。从unicode到uft-8并不是直接的对应，而是要过一些算法和规则来转换。Unicode符号范围 | UTF-8编码方式(十六进制)         |        （二进制）<br>—————————————————————–<br>0000 0000-0000 007F | 0xxxxxxx<br>0000 0080-0000 07FF | 110xxxxx 10xxxxxx<br>0000 0800-0000 FFFF | 1110xxxx 10xxxxxx 10xxxxxx<br>0001 0000-0010 FFFF | 11110xxx 10xxxxxx 10xxxxxx 10xxxxxx原文：unicode,ansi,utf-8,unicode big endian编码的区别</p>
<p>原文:<a href="https://wenku.baidu.com/view/cb9fe505cc17552707220865.html" target="_blank" rel="external">https://wenku.baidu.com/view/cb9fe505cc17552707220865.html</a></p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;很久很久以前，有一群人，他们决定用8个可以开合的晶体管来组合成不同的状态，以表示世界上的万物。他们看到8个开关状态是好的，于是他们把这称为”字节“。再后来，他们又做了一些可以处理这些字节的机器，机器开动了，可以用字节来组合出很多状态，状态开始变来变去。他们看到这样是好的，于是它们就这机器称为”计算机“。开始计算机只在美国用。八位的字节一共可以组合出256(2的8次方)种不同的状态。&lt;br&gt;
    
    </summary>
    
      <category term="软件" scheme="http://sunhao.win/categories/%E8%BD%AF%E4%BB%B6/"/>
    
    
      <category term="utf8" scheme="http://sunhao.win/tags/utf8/"/>
    
      <category term="unicode" scheme="http://sunhao.win/tags/unicode/"/>
    
  </entry>
  
  <entry>
    <title>linux-crontab</title>
    <link href="http://sunhao.win/articles/linux-crontab.html"/>
    <id>http://sunhao.win/articles/linux-crontab.html</id>
    <published>2017-04-25T00:47:48.000Z</published>
    <updated>2017-04-25T01:03:40.787Z</updated>
    
    <content type="html"><![CDATA[<p><img src="http://ojlt0g866.bkt.clouddn.com/blog/20170425/084113058.png" alt="mark"><br>该词来源于希腊语 chronos(χρνο)，原意是时间。常，crontab储存的指令被守护进程激活， crond常常在后台运行，每一分钟检查是否有预定的作业需要执行。这类作业一般称为cron jobs。</p>
<a id="more"></a>
<p>使用权限:</p>
<p>root用户和crontab文件的所有者</p>
<p>语法:</p>
<p>crontab [-e [UserName]|-l [UserName]|-r [UserName]|-v [UserName]|File ]</p>
<p>说明:</p>
<p>crontab 是用来让使用者在固定时间或固定间隔执行程序之用，换句话说，也就是类似使用者的时程表。</p>
<p>-u user 是指设定指定 user 的时程表，这个前提是你必须要有其权限(比如说是 root)才能够指定他人的时程表。如果不使用 -u user 的话，就是表示设定自己的时程表。</p>
<p>参数:</p>
<p>-e [UserName]: 执行文字编辑器来设定时程表，内定的文字编辑器是 VI，如果你想用别的文字编辑器，则请先设定 VISUAL 环境变数来指定使用那个文字编辑器(比如说 setenv VISUAL joe)</p>
<p>-r [UserName]: 删除目前的时程表</p>
<p>-l [UserName]: 列出目前的时程表</p>
<p>-v [UserName]:列出用户cron作业的状态</p>
<p>时程表的格式如下:</p>
<p>f1 f2 f3 f4 f5 program</p>
<p>其中 f1 是表示分钟，f2 表示小时，f3 表示一个月份中的第几日，f4 表示月份，f5 表示一个星期中的第几天。program 表示要执行的程式。</p>
<p>当 f1 为 <em> 时表示每分钟都要执行 program，f2 为 </em> 时表示每小时都要执行程式，其余类推</p>
<p>当 f1 为 a-b 时表示从第 a 分钟到第 b 分钟这段时间内要执行，f2 为 a-b 时表示从第 a 到第 b 小时都要执行，其余类推</p>
<p>当 f1 为 <em>/n 时表示每 n 分钟个时间间隔执行一次，f2 为 </em>/n 表示每 n 小时个时间间隔执行一次，其余类推</p>
<p>当 f1 为 a, b, c,… 时表示第 a, b, c,… 分钟要执行，f2 为 a, b, c,… 时表示第 a, b, c…个小时要执行，其余类推</p>
<p>使用者也可以将所有的设定先存放在档案 file 中，用 crontab file 的方式来设定时程表。</p>
<p>由于unix版本不一样，所以部分语法有差别，例如在hp unix aix 中设定间隔执行如果采用*/n 方式将出现语法错误，在这类unix中 ，间隔执行只能以列举方式。</p>
<p>使用方法</p>
<p>用VI编辑一个文件 cronfile，然后在这个文件中输入格式良好的时程表。编辑完成后，保存并退出。[2] </p>
<p>在命令行输入</p>
<p>$: crontab cronfile</p>
<p>这样就将cronfile文件提交给c r o n进程，同时，新创建cronfile的一个副本已经被放在/ v a r / s p o o l / c r o n目录中，文件名就是用户名。</p>
<p>例子:</p>
<p>每月每天每小时的第 0 分钟执行一次 /bin/ls :</p>
<p>0 <em> </em> <em> </em> /bin/ls</p>
<p>在 12 月内, 每天的早上 6 点到 12 点中，每隔 20 分钟执行一次 /usr/bin/backup :</p>
<p><em>/20 6-12 </em> 12 * /usr/bin/backup</p>
<p>周一到周五每天下午 5:00 寄一封信给 alex_mail_name :</p>
<p>0 17 <em> </em> 1-5 mail -s “hi” alex_mail_name &lt; /tmp/maildata</p>
<p>每月每天的午夜 0 点 20 分, 2 点 20 分, 4 点 20 分….执行 echo “haha”</p>
<p>20 0-23/2 <em> </em> * echo “haha”</p>
<p>晚上11点到早上8点之间每两个小时，早上8点</p>
<p>0 23-7/2，8 <em> </em> * date</p>
<p>在hpunix,中，每20分钟执行一次，表示为：0,20,40 <em> </em> <em> </em> 而不能采用*/n方式，否则出现语法错误</p>
<p>30 21 <em> </em> * /usr/local/apache/bin/apachectl restart<br>上面的例子表示每晚的21:30重启apache。</p>
<p>45 4 1,10,22 <em> </em> /usr/local/apache/bin/apachectl restart<br>上面的例子表示每月1、10、22日的4 : 45重启apache。</p>
<p>10 1 <em> </em> 6,0 /usr/local/apache/bin/apachectl restart<br>上面的例子表示每周六、周日的1 : 10重启apache。</p>
<p>0,30 18-23 <em> </em> * /usr/local/apache/bin/apachectl restart<br>上面的例子表示在每天18 : 00至23 : 00之间每隔30分钟重启apache。</p>
<p>0 23 <em> </em> 6 /usr/local/apache/bin/apachectl restart<br>上面的例子表示每星期六的11 : 00 pm重启apache。</p>
<ul>
<li><p><em>/1 </em> <em> </em> /usr/local/apache/bin/apachectl restart<br>每一小时重启apache</p>
</li>
<li><p>23-7/1 <em> </em> * /usr/local/apache/bin/apachectl restart<br>晚上11点到早上7点之间，每隔一小时重启apache</p>
</li>
</ul>
<p>0 11 4 * mon-wed /usr/local/apache/bin/apachectl restart<br>每月的4号与每周一到周三的11点重启apache</p>
<p>0 4 1 jan * /usr/local/apache/bin/apachectl restart<br>一月一号的4点重启apache</p>
<p>注意:</p>
<ol>
<li><p>当程式在你所指定的时间执行后，系统会寄一封信给你，显示该程式执行的内容，若是你不希望收到这样的信，请在每一行空一格之后加上 &gt; /dev/null 2&gt;&amp;1 即可。</p>
</li>
<li><p>%在crontab中被认为是newline，要用\来escape才行。比如crontab执行行中，如果有”date +%Y%m%d”，必须替换为：”date +\%Y\%m\%d”<br>创建crontab</p>
</li>
</ol>
<p>在考虑向cron进程提交一个crontab文件之前，首先要做的一件事情就是设置环境变量EDITOR。cron进程根据它来确定使用哪个编辑器编辑crontab文件。99 %的UNIX和LINUX用户都使用vi，如果你也是这样，那么你就编辑$HOME目录下的.profile文件，在其中加入这样一行：<br>EDITOR=vi; export EDITOR<br>然后保存并退出。</p>
<p>不妨创建一个名为<user>cron的文件，其中<user>是用户名，为了提交你刚刚创建的crontab文件，可以把这个新创建的文件作为cron命令的参数：</user></user></p>
<p>$ crontab davecron</p>
<p>现在该文件已经提交给cron进程，同时，新创建文件的一个副本已经被放在/var/spool/cron目录中，文件名就是用户名（即，dave）。</p>
<p>列出crontab文件</p>
<p>为了列出crontab文件，可以用：</p>
<p>$crontab -l</p>
<p>编辑crontab文件</p>
<p>如果希望添加、删除或编辑crontab文件中的条目，而EDITOR环境变量又设置为vi，那么就可以用vi来编辑crontab文件，相应的命令为：</p>
<p>$ crontab -e</p>
<p>可以像使用vi编辑其他任何文件那样修改crontab文件并退出。</p>
<p>删除crontab文件</p>
<p>为了删除crontab文件，可以用：</p>
<p>$ crontab -r<br>注释crontab文件<br>如果不希望删除写好的crontab文件，在该crontab文件前添加#将该文件注释掉。<br>恢复丢失的crontab文件<br>如果不小心误删了crontab文件，假设你在自己的$HOME目录下还有一个备份，那么可以将其拷贝到/var/spool/cron/<username>，其中<username>是用户名。如果由于权限问题无法完成拷贝，可以用：</username></username></p>
<p>$ crontab <filename></filename></p>
<p>其中，<filename>是你在$HOME目录中副本的文件名。</filename></p>
<p>crontab中的输出配置</p>
<p>crontab中经常配置运行脚本输出为：&gt;/dev/null 2&gt;&amp;1，来避免crontab运行中有内容输出。</p>
<p>shell命令的结果可以通过‘&gt; ’的形式来定义输出</p>
<p>/dev/null 代表空设备文件</p>
<blockquote>
<p>代表重定向到哪里，例如：echo “123” &gt; /home/123.txt</p>
</blockquote>
<p>1 表示stdout标准输出，系统默认值是1，所以”&gt;/dev/null”等同于”1&gt;/dev/null”</p>
<p>2 表示stderr标准错误</p>
<p>&amp; 表示等同于的意思，2&gt;&amp;1，表示2的输出重定向等同于1</p>
<p>那么重定向输出语句的含义：</p>
<p>1&gt;/dev/null 首先表示标准输出重定向到空设备文件，也就是不输出任何信息到终端，不显示任何信息。</p>
<p>2&gt;&amp;1 表示标准错误输出重定向等同于标准输出，因为之前标准输出已经重定向到了空设备文件，所以标准错误输出也重定向到空设备文件。</p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;img src=&quot;http://ojlt0g866.bkt.clouddn.com/blog/20170425/084113058.png&quot; alt=&quot;mark&quot;&gt;&lt;br&gt;该词来源于希腊语 chronos(χρνο)，原意是时间。常，crontab储存的指令被守护进程激活， crond常常在后台运行，每一分钟检查是否有预定的作业需要执行。这类作业一般称为cron jobs。&lt;/p&gt;
    
    </summary>
    
      <category term="linux" scheme="http://sunhao.win/categories/linux/"/>
    
    
      <category term="linux" scheme="http://sunhao.win/tags/linux/"/>
    
      <category term="crontab" scheme="http://sunhao.win/tags/crontab/"/>
    
  </entry>
  
  <entry>
    <title>linux-iftop查看带宽-iptables</title>
    <link href="http://sunhao.win/articles/linux-iftop-iptables.html"/>
    <id>http://sunhao.win/articles/linux-iftop-iptables.html</id>
    <published>2017-04-24T03:10:48.000Z</published>
    <updated>2017-04-24T03:48:33.000Z</updated>
    
    <content type="html"><![CDATA[<p>iftop用于网络监控 if本身的意思就是interface的缩写</p>
<p>安装直接yum install iftop就可以</p>
<p>输入iftop即可登录</p>
<p>默认监控eth0</p>
<p>设置参数iftop -i eth1      -i参数就是选择网卡。这里选择eth1</p>
<p><img src="http://ojlt0g866.bkt.clouddn.com/blog/20170424/113333395.png" alt="mark"></p>
<p>然后使用iptables禁掉占用高的ip</p>
<p>iptables  -A  OUTPUT  -d  <em>.</em>.*.157 -j  REJECT</p>
<a id="more"></a>
<h3 id="1、iftop界面相关说明"><a href="#1、iftop界面相关说明" class="headerlink" title="1、iftop界面相关说明"></a>1、iftop界面相关说明</h3><p>界面上面显示的是类似刻度尺的刻度范围，为显示流量图形的长条作标尺用的。</p>
<p>中间的&lt;= =&gt;这两个左右箭头，表示的是流量的方向。</p>
<p>  TX：发送流量</p>
<p>  RX：接收流量</p>
<p>  TOTAL：总流量</p>
<p>  Cumm：运行iftop到目前时间的总流量</p>
<p>  peak：流量峰值</p>
<p>  rates：分别表示过去 2s 10s 40s 的平均流量</p>
<h3 id="2、iftop相关参数"><a href="#2、iftop相关参数" class="headerlink" title="2、iftop相关参数"></a>2、iftop相关参数</h3><p>常用的参数</p>
<p>  -i设定监测的网卡，如：# iftop -i eth1</p>
<p>  -B 以bytes为单位显示流量(默认是bits)，如：# iftop -B</p>
<p>  -n使host信息默认直接都显示IP，如：# iftop -n</p>
<p>  -N使端口信息默认直接都显示端口号，如: # iftop -N</p>
<p>  -F显示特定网段的进出流量，如# iftop -F 10.10.1.0/24或# iftop -F 10.10.1.0/255.255.255.0<br>  -h（display this message），帮助，显示参数信息</p>
<p>  -p使用这个参数后，中间的列表显示的本地主机信息，出现了本机以外的IP信息;</p>
<p>  -b使流量图形条默认就显示;</p>
<p>  -f这个暂时还不太会用，过滤计算包用的;</p>
<p>  -P使host信息及端口信息默认就都显示;</p>
<p>  -m设置界面最上边的刻度的最大值，刻度分五个大段显示，例：# iftop -m 100M</p>
<p>进入iftop画面后的一些操作命令(注意大小写)</p>
<p>  按h切换是否显示帮助;</p>
<p>  按n切换显示本机的IP或主机名;</p>
<p>  按s切换是否显示本机的host信息;</p>
<p>  按d切换是否显示远端目标主机的host信息;</p>
<p>  按t切换显示格式为2行/1行/只显示发送流量/只显示接收流量;</p>
<p>  按N切换显示端口号或端口服务名称;</p>
<p>  按S切换是否显示本机的端口信息;</p>
<p>  按D切换是否显示远端目标主机的端口信息;</p>
<p>  按p切换是否显示端口信息;</p>
<p>  按P切换暂停/继续显示;</p>
<p>  按b切换是否显示平均流量图形条;</p>
<p>  按B切换计算2秒或10秒或40秒内的平均流量;</p>
<p>  按T切换是否显示每个连接的总流量;</p>
<p>  按l打开屏幕过滤功能，输入要过滤的字符，比如ip,按回车后，屏幕就只显示这个IP相关的流量信息;</p>
<p>  按L切换显示画面上边的刻度;刻度不同，流量图形条会有变化;</p>
<p>  按j或按k可以向上或向下滚动屏幕显示的连接记录;</p>
<p>  按1或2或3可以根据右侧显示的三列流量数据进行排序;</p>
<p>  按&lt;根据左边的本机名或IP排序;</p>
<p>  按&gt;根据远端目标主机的主机名或IP排序;</p>
<p>  按o切换是否固定只显示当前的连接;</p>
<p>  按f可以编辑过滤代码，这是翻译过来的说法，我还没用过这个！</p>
<p>  按!可以使用shell命令，</p>
<p>  按q退出监控。</p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;iftop用于网络监控 if本身的意思就是interface的缩写&lt;/p&gt;
&lt;p&gt;安装直接yum install iftop就可以&lt;/p&gt;
&lt;p&gt;输入iftop即可登录&lt;/p&gt;
&lt;p&gt;默认监控eth0&lt;/p&gt;
&lt;p&gt;设置参数iftop -i eth1      -i参数就是选择网卡。这里选择eth1&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://ojlt0g866.bkt.clouddn.com/blog/20170424/113333395.png&quot; alt=&quot;mark&quot;&gt;&lt;/p&gt;
&lt;p&gt;然后使用iptables禁掉占用高的ip&lt;/p&gt;
&lt;p&gt;iptables  -A  OUTPUT  -d  &lt;em&gt;.&lt;/em&gt;.*.157 -j  REJECT&lt;/p&gt;
    
    </summary>
    
      <category term="linux" scheme="http://sunhao.win/categories/linux/"/>
    
    
      <category term="iftop" scheme="http://sunhao.win/tags/iftop/"/>
    
      <category term="iptables" scheme="http://sunhao.win/tags/iptables/"/>
    
  </entry>
  
  <entry>
    <title>架构师之路</title>
    <link href="http://sunhao.win/articles/soft-architect.html"/>
    <id>http://sunhao.win/articles/soft-architect.html</id>
    <published>2017-04-24T00:47:00.000Z</published>
    <updated>2017-04-24T07:24:20.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="架构师之路-1-—面向过程和面向对象"><a href="#架构师之路-1-—面向过程和面向对象" class="headerlink" title="架构师之路(1)—面向过程和面向对象"></a>架构师之路(1)—面向过程和面向对象</h2><p>自学收集，如需观看，请访问原文。<br><a href="http://blog.csdn.net/phphot/article/details/4050193" target="_blank" rel="external">http://blog.csdn.net/phphot/article/details/4050193</a></p>
<h3 id="1、引言"><a href="#1、引言" class="headerlink" title="1、引言"></a>1、引言</h3><p>机算机科学是一门应用科学，它的知识体系是典型的倒三角结构，所用的基础知识并不多，只 是随着应用领域和方向的不同，产生了很多的分支，所以说编程并不是一件很困难的事情，一个高中生经过特定的训练就可以做得到。但是，会编程和编好程绝对是 两码事，同样的程序员，有的人几年之后成为了架构师，有的人却还在不停地coding，只不过ctrl-c、ctrl-v用得更加纯熟了。在中国，编程人 员最终的归途无外乎两条：一是转向技术管理，它的终点是CTO；二是继续深入，它的终点是首席架构师，成为CEO的人毕竟是少数。如果你现在还是个普通的 程序员，希望继续在技术这条路上前进的话，我想你还是应该先补充一点软件工程的思想，学习一点有关设计模式的知识，只有具备这些能力，你才能从整体和宏观 层面来考虑问题、分析问题和解决问题。本人Coding了很多年，中间走了不少弯路，虽然最终没什么大成就，但总算有一些心得，很愿意把自己的一些经验拿 出来跟大家分享，这或许对你的发展有所帮助。</p>
<p>由程序员转为架构师，最绕不开的概念就算是面向对象(OO)了。记得在大学的时候，我们专业开了一门课叫《面向对象的编程》。那个时候，我们刚刚学 了一门C语言，开发环境用的还是DOS下的Turbo C，半点项目开发的经验都没有，纯粹的空对空。所以，一学期下来，我始终处于一种懵懂状态，既没领会面向过程和面向对象到底有什么区别，也没搞懂面向对象 能带来什么好处。</p>
<a id="more"></a>
<h2 id="架构师之路-2-—详解面向过程"><a href="#架构师之路-2-—详解面向过程" class="headerlink" title="架构师之路(2)—详解面向过程"></a>架构师之路(2)—详解面向过程</h2><h3 id="2、面向过程-OP-和面向对象-OO"><a href="#2、面向过程-OP-和面向对象-OO" class="headerlink" title="2、面向过程(OP)和面向对象(OO)"></a>2、面向过程(OP)和面向对象(OO)</h3><h4 id="2-1-蛋炒饭和盖浇饭"><a href="#2-1-蛋炒饭和盖浇饭" class="headerlink" title="2.1 蛋炒饭和盖浇饭"></a>2.1 蛋炒饭和盖浇饭</h4><p> 有人这么形容OP和OO的不同：用面向过程的方法写出来的程序是一份蛋炒饭，而用面向对象写出来的程序是一份盖浇饭。所谓盖浇饭，北京叫盖饭，东北叫烩 饭，广东叫碟头饭，就是在一碗白米饭上面浇上一份盖菜，你喜欢什么菜，你就浇上什么菜。我觉得这个比喻还是比较贴切的。<br>蛋炒饭制作的细节，我不太清楚，因为我没当过厨师，也不会做饭，但最后的一道工序肯定是把米饭和鸡蛋混在一起炒匀。盖浇饭呢，则是把米饭和盖菜分别做好，你如果要一份红烧肉盖饭呢，就给你浇一份红烧肉；如果要一份青椒土豆盖浇饭，就给浇一份青椒土豆丝。</p>
<p> 蛋炒饭的好处就是入味均匀，吃起来香。如果恰巧你不爱吃鸡蛋，只爱吃青菜的话，那么唯一的办法就是全部倒掉，重新做一份青菜炒饭了。盖浇饭就没这么多麻烦，你只需要把上面的盖菜拨掉，更换一份盖菜就可以了。盖浇饭的缺点是入味不均，可能没有蛋炒饭那么香。<br>到底是蛋炒饭好还是盖浇饭好呢？其实这类问题都很难回答，非要比个上下高低的话，就必须设定一个场景，否则只能说是各有所长。如果大家都不是美食家，没那么多讲究，那么从饭馆角度来讲的话，做盖浇饭显然比蛋炒饭更有优势，他可以组合出来任意多的组合，而且不会浪费。</p>
<h4 id="2-2-软件工程"><a href="#2-2-软件工程" class="headerlink" title="2.2 软件工程"></a>2.2 软件工程</h4><p> 盖浇饭的好处就是“菜”“饭”分离，从而提高了制作盖浇饭的灵活性。饭不满意就换饭，菜不满意换菜。用软件工程的专业术语就是“可维护性”比较好，“饭” 和“菜”的耦合度比较低。蛋炒饭将“蛋”“饭”搅和在一起，想换“蛋”“饭”中任何一种都很困难，耦合度很高，以至于“可维护性”比较差。软件工程追求的 目标之一就是可维护性，可维护性主要表现在3个方面：可理解性、可测试性和可修改性。面向对象的好处之一就是显著的改善了软件系统的可维护性。</p>
<p> 面向过程(OP)和面向对象(OO)是不是就是指编码的两种方式呢？不是！你拿到了一个用户需求，比如有人要找你编个软件，你是不是需要经过需求分析，然 后进行总体/详细设计，最后编码，才能最终写出软件，交付给用户。这个过程是符合人类基本行为方式的：先想做什么，再想如何去做，最后才是做事情。有的同 学说：“我没按照你说的步骤做啊，我是直接编码的”。其实，你一定会经历了这三个阶段，只不过你潜意识里没有分得那么清楚。对于拿到需求就编码的人，可能 编着编着，又得倒回去重新琢磨，还是免不了这些过程，</p>
<p> 以OO为例，对应于软件开发的过程，OO衍生出3个概念：OOA、OOD和OOP。采用面向对象进行分析的方式称为OOA，采用面向对象进行设计的方式称 为OOD，采用面向对象进行编码的方式称为OOP。面向过程(OP)和面向对象(OO)本质的区别在于分析方式的不同，最终导致了编码方式的不同。</p>
<h4 id="2-3-面向过程编程-OPP-和面向对象编程-OOP-的关系"><a href="#2-3-面向过程编程-OPP-和面向对象编程-OOP-的关系" class="headerlink" title="2.3 面向过程编程(OPP) 和面向对象编程(OOP)的关系"></a>2.3 面向过程编程(OPP) 和面向对象编程(OOP)的关系</h4><p> 关于面向过程的编程(OPP)和面向对象的编程(OOP),给出这它们的定义的人很多，您可以从任何资料中找到很专业的解释，但以我的经验来看，讲的相对枯燥一点，不是很直观。除非您已经有了相当的积累，否则说起来还是比较费劲。</p>
<p>我是个老程序员出身，虽然现在的日常工作更多倾向了管理，但至今依然保持编码的习惯，这句话什么意思呢？我跟大家沟通应该没有问题。无论你是在重复 我走过的路，或者已经走在了我的前面，大家都会有那么一段相同的经历，都会在思想层面上有一种理解和默契，所以我还是会尽量按照大多数人的常规思维写下 去。</p>
<p>面向过程的编程(OPP)产生在前，面向对象的编程(OOP)产生在后，所以面向对象的编程(OOP)一定会继承前者的一些优点，并摒弃前者存在的 一些缺点，这是符合人类进步的自然规律。两者在各自的发展和演变过程中，一定会相互借鉴，相互融合，吸收对方的优点，从而出现某些方面的趋同性。但是，即 使两者有更多的相似点，也不会改变它们本质上的不同，因为它们的出发点不同，完全是两种截然不同的思维方式。关于两者的关系，我的观点是这样的：面向对象 编程(OOP)在局部上一定是面向过程(OP)的，面向过程的编程(OPP)在整体上应该借鉴面向对象(OO)的思想。这一段说的的确很空洞，而且也一定 会有引来争议，不过，我劝您还是在阅读了后面的内容之后，再来评判我观点的正确与否。</p>
<p>象C++、C#、Java等都是面向对象的语言，c,PHP(暂且这么说，因为php4以后就支持OO)都是面向过程的语言，那么是不是我用C++ 写的程序一定就是面向对象，用c写的程序一定就是面向过程呢？这种观点显然是没有真正吃透两者的区别。语言永远是一种工具，前辈们每创造出来的一种语言， 都是你用来实现想法的利器。我觉得好多人用C#,Java写出来的代码，要是仔细看看，那实际就是用面向对象(OO)的语言写的面向过程(OP)的程序。</p>
<p>所以，即使给关羽一根木棍，给你一杆青龙偃月刀，他照样可以打得你满头是包。你就是扛着个偃月刀，也成不了关羽，因为你缺乏关羽最本质的东西—绝世武功。同样的道理，如果你没有领会OO思想，怎么可能写得出真正的OO程序呢？</p>
<p>那是不是面向过程就不好，也没有存在的必要了？我从来没有这样说过。事实上，面向过程的编程(OPP)已经存在了几十年了，现在依然有很多人在使 用。它的优点就是逻辑不复杂的情况下很容易理解，而且运行效率远高于面向对象（OO）编写的程序。所以，系统级的应用或准实时系统中，依然采用面向过程的 编程(OPP)。当然，很多编程高手以及大师级的人物，他们由于对于系统整体的掌控能力很强，也喜欢使用面向过程的编程(OPP)，比如像 Apache,QMail,PostFix,ICE等等这些比较经典的系统都是OPP的产物。象php这些脚本语言，主要用于web开发，对于一些业务逻 辑相对简单的系统，也常使用面向过程的编程(OPP)，这也是php无法跨入到企业级应用开发的原因之一，不过php5目前已经能够很好的支持OO了。</p>
<h4 id="2-4-详解面向过程的编程-OPP"><a href="#2-4-详解面向过程的编程-OPP" class="headerlink" title="2.4 详解面向过程的编程(OPP)"></a>2.4 详解面向过程的编程(OPP)</h4><p>  在面向对象出现之前，我们采用的开发方法都是面向过程的编程(OPP)。面向过程的编程中最常用的一个分析方法是“功能分解”。我们会把用户需求先分解成 模块，然后把模块分解成大的功能，再把大的功能分解成小的功能，整个需求就是按照这样的方式，最终分解成一个一个的函数。这种解决问题的方式称为“自顶向 下”，原则是“先整体后局部”，“先大后小”，也有人喜欢使用“自下向上”的分析方式，先解决局部难点，逐步扩大开来，最后组合出来整个程序。其实，这两 种方式殊路同归，最终都能解决问题，但一般情况下采用“自顶向下”的方式还是较为常见，因为这种方式最容易看清问题的本质。</p>
<p>我举个例子来说明面向过程的编程方式:</p>
<p>用户需求：老板让我写个通用计算器。</p>
<p>最终用户就是老板，我作为程序员，任务就是写一个计算器程序。OK，很简单，以下就是用C语言完成的计算器：</p>
<p>假定程序的文件名为：main.c。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span> *argv[])</span></span>&#123;</div><div class="line"></div><div class="line"> <span class="comment">//变量初始化</span></div><div class="line"> <span class="keyword">int</span> nNum1,nNum2;</div><div class="line"> <span class="keyword">char</span> cOpr;</div><div class="line"> <span class="keyword">int</span> nResult;</div><div class="line"> nNum1 = nNum2 = <span class="number">0</span>;</div><div class="line"> cOpr = <span class="number">0</span>;</div><div class="line"> nResult = <span class="number">0</span>;</div><div class="line"></div><div class="line"> <span class="comment">//输入数据</span></div><div class="line"> <span class="built_in">printf</span>(<span class="string">"Please input the first number:/r/n"</span>);</div><div class="line"> <span class="built_in">scanf</span>(<span class="string">"%d"</span>,&amp;nNum1);</div><div class="line"> <span class="built_in">printf</span>(<span class="string">"Please input the operator:/r/n"</span>);</div><div class="line"> <span class="built_in">scanf</span>(<span class="string">"%s"</span>,&amp;cOpr);</div><div class="line"> <span class="built_in">printf</span>(<span class="string">"Please input the second number:/r/n"</span>);</div><div class="line"> <span class="built_in">scanf</span>(<span class="string">"%d"</span>,&amp;nNum2); </div><div class="line"></div><div class="line"> <span class="comment">//计算结果  </span></div><div class="line"> <span class="keyword">if</span>( cOpr == <span class="string">'+'</span> )&#123;</div><div class="line"> nResult = nNum1 + nNum2;</div><div class="line"> &#125;<span class="keyword">else</span> <span class="keyword">if</span>( cOpr == <span class="string">'-'</span> )&#123;</div><div class="line"> nResult = nNum1 - nNum2;</div><div class="line"> &#125;<span class="keyword">else</span>&#123;</div><div class="line"> <span class="built_in">printf</span>(<span class="string">"Unknown operator!"</span>);</div><div class="line"> <span class="keyword">return</span> <span class="number">-1</span>;</div><div class="line"> &#125;</div><div class="line"></div><div class="line"> <span class="comment">//输出结果</span></div><div class="line"> <span class="built_in">printf</span>(<span class="string">"The result is %d!"</span>,nResult);</div><div class="line"> <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>抛开细节不讲，我想大多数人差不多都会这么实现吧，很清晰，很简单，充分体现了“简单就是美”的原则，面向过程的编程就是这样有条理的按照顺序来逐步实现用户需求。</p>
<p>凡是做过程序的人都知道，用户需求从来都不会是稳定的，最多只能够做到“相对稳定”。用户可能会随时提出加个功能，减个功能的要求，也可能会要求改 动一下流程，程序员最烦的就是频繁地变动需求，尤其是程序已经写了大半了，但这种情况是永远无法避免的，也不能完全归罪到客户或者需求分析师。</p>
<p>以我们上面的代码为例，用户可能会提出类似的要求：<br>首先，你程序中实现了“加法”和“减法”，我还想让它也能计算“乘法”、“除法”。<br>其次，你现在的人机界面太简单了，我还想要个Windows计算器的界面或者Mac计算器的界面。</p>
<p>用户需求开始多了，我得琢磨琢磨该如何去写这段代码了。我今天加了“乘”“除”的运算，明天保不齐又得让我加个“平方”、“立方”的运算，这要是把 所有的运算都穷尽了，怎么也得写个千八百行代码吧。还有，用户要求界面能够更换，还得写一大堆界面生成的代码，又得来个千八百行。以后，这么多代码堆在一 起，怎么去维护，找个变量得半天，看懂了代码得半天，万一不小心改错了，还得调半天。另外，界面设计我也不擅长，得找个更专业的人来做，做完了之后再加进 来吧。这个过程也就是“软件危机”产生的过程。伴随着软件广泛地应用于各个领域，软件开发的规模变得越来越大，复杂度越来越高，而其用户的需求越来越不稳 定。</p>
<p>根据用户提出的两个需求，面向过程的编程该如何去应对呢？我想大家都很清楚怎么去改。Very easy，把“计算”和“界面”分开做成两个独立的函数，封装到不同的文件中。<br>假定程序的文件名为：main.c。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"interface.h"</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"calculate.h"</span></span></div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span> *argv[])</span></span>&#123;</div><div class="line"></div><div class="line"> <span class="comment">//变量初始化</span></div><div class="line"> <span class="keyword">int</span> nNum1,nNum2;</div><div class="line"> <span class="keyword">char</span> cOpr;</div><div class="line"> <span class="keyword">int</span> nResult;</div><div class="line"> nNum1 = nNum2 = <span class="number">0</span>;</div><div class="line"> cOpr = <span class="number">0</span>;</div><div class="line"> nResult = <span class="number">0</span>;</div><div class="line"></div><div class="line"> <span class="comment">//输入数据</span></div><div class="line"> <span class="keyword">if</span>( getParameters(&amp;nNum1,&amp;nNum2,&amp;cOpr) == <span class="number">-1</span> )</div><div class="line"> <span class="keyword">return</span> <span class="number">-1</span>;</div><div class="line"></div><div class="line"> <span class="comment">//计算结果  </span></div><div class="line"> <span class="keyword">if</span>( calcMachine(nNum1,nNum2,cOpr,&amp;nResult) == <span class="number">-1</span> )</div><div class="line"> <span class="keyword">return</span> <span class="number">-1</span>;</div><div class="line"></div><div class="line"> <span class="comment">//输出结果</span></div><div class="line"> <span class="built_in">printf</span>(<span class="string">"The result is %d!"</span>,nResult);</div><div class="line"></div><div class="line"> <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line">interface.h:</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">getParameters</span><span class="params">(<span class="keyword">int</span> *nNum1,<span class="keyword">int</span> * nNum2,<span class="keyword">char</span> *cOpr)</span></span>;</div><div class="line"></div><div class="line">interface.c:</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">getParameters</span><span class="params">(<span class="keyword">int</span> *nNum1,<span class="keyword">int</span> * nNum2,<span class="keyword">char</span> *cOpr)</span></span>&#123;</div><div class="line"> <span class="built_in">printf</span>(<span class="string">"Please input the first number:/r/n"</span>);</div><div class="line"> <span class="built_in">scanf</span>(<span class="string">"%d"</span>,nNum1);</div><div class="line"> <span class="built_in">printf</span>(<span class="string">"Please input the operator:/r/n"</span>);</div><div class="line"> <span class="built_in">scanf</span>(<span class="string">"%s"</span>,cOpr);</div><div class="line"> <span class="built_in">printf</span>(<span class="string">"Please input the second number:/r/n"</span>);</div><div class="line"> <span class="built_in">scanf</span>(<span class="string">"%d"</span>,nNum2);</div><div class="line"></div><div class="line"> <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line">calculate.h:</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">calcMachine</span><span class="params">(<span class="keyword">int</span> nNum1,<span class="keyword">int</span> nNum2,<span class="keyword">char</span> cOpr, <span class="keyword">int</span> *nResult)</span></span>;</div><div class="line"></div><div class="line">calculate.c:</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">calcMachine</span><span class="params">(<span class="keyword">int</span> nNum1,<span class="keyword">int</span> nNum2,<span class="keyword">char</span> cOpr,<span class="keyword">int</span> *nResult)</span></span>&#123;</div><div class="line"> <span class="keyword">if</span>( cOpr == <span class="string">'+'</span> )&#123;</div><div class="line">  *nResult = nNum1 + nNum2;</div><div class="line"> &#125;<span class="keyword">else</span> <span class="keyword">if</span>( cOpr == <span class="string">'-'</span> )&#123;</div><div class="line">  *nResult = nNum1 - nNum2;</div><div class="line"> &#125;<span class="keyword">else</span>&#123;</div><div class="line">  <span class="built_in">printf</span>(<span class="string">"Unknown operator!"</span>);</div><div class="line">  <span class="keyword">return</span> <span class="number">-1</span>;</div><div class="line"> &#125;;</div><div class="line"> <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>“计算”和“界面”分开之后，添加新功能或者修改bug就方便多了，遇到与“计算”相关的需求就去修改calculate模块，遇到与“界面”相关的需求就去修改interface模块，因此，整个系统模块之间的“耦合度”就被放松了，可维护性有了一定程度的改善。</p>
<p>面向过程的编程(OPP)就是将用户需求进行“功能分解”。把用户需求先分解成模块(.h,.c)，再把模块(.h,.c)分解成大的功能(function)，然后把大的功能(function)分解成小的功能(function)，如此类推。</p>
<p>功能分解是一项很有技术含量的工作，它不仅需要分解者具有丰富的实战经验，而且需要科学的理论作为指导。如何分解，分解原则是什么，模块粒度多大合适？这些都是架构师的要考虑的问题，也是我们后面要着重讲的内容。</p>
<p>面向过程的编程(OPP)优点是程序顺序执行，流程清晰明了。它的缺点是主控程序承担了太多的任务，各个模块都需要主控程序进行控制和调度，主控和模块之间的承担的任务不均衡。<br>有的人把面向过程定义为：算法 + 数据结构，我觉得也很准确。面向过程的编程中算法是核心，数据处于从属地位，数据随算法而流动。所以采用面向过程的方式进行编程，一般在动手之前，都要编写一份流程图或是数据流图。</p>
<h2 id="架构师之路-3-—架构师的职责"><a href="#架构师之路-3-—架构师的职责" class="headerlink" title="架构师之路(3)—架构师的职责"></a>架构师之路(3)—架构师的职责</h2><h3 id="3-架构师的职责"><a href="#3-架构师的职责" class="headerlink" title="3 架构师的职责"></a>3 架构师的职责</h3><p> 近来看到CSDN上有个CTO俱乐部，里面聊得是不亦乐乎。我怀着无比崇敬的态度，拜读了一下牛人们的发言。里面有个哥们发起一个话题：“CTO, 你多久没有写程序了？”。有人回答：“不写代码的CTO,属于……这公司问题大了!”。看到这里，我就赶紧撤了，怕忍不住反驳几句，反而遭到牛人 们的群殴。试想，一个上点规模的IT公司，还得靠CTO来写程序的话，那是不是才叫问题大了呢。当然，我没有做过CTO，所以我有我的不同看法，而且还愿 意表达出来，无知者无畏。我情愿相信：我所理解的CTO跟这位CTO所理解的是两回事。所以我想，如果有人能把CTO的职责给标准化了，也许就不会有这么 多的争论了。<br> 同样的道理，关于架构师的定义，大家也有着不同的理解。什么是架构师？架构师有哪些职责？我觉得有必要提前明确一下，要不然大家沟通起来也会产生类似问题，子说子理，卯说卯理，但是压根说得不是一码子事。</p>
<h4 id="3-1-什么是架构师"><a href="#3-1-什么是架构师" class="headerlink" title="3.1 什么是架构师"></a>3.1 什么是架构师</h4><p>曾经有这么个段子：<br>甲：我已经应聘到一家中型软件公司了，今天上班的时候，全公司的人都来欢迎我。<br>乙：羡慕ing，都什么人来了？<br>甲：CEO、COO、CTO、All of 程序员，还有会计、司机都来了。<br>乙：哇，他们太重视你了，人才啊，这么多人迎接你！<br>甲：没有啊，就一个人！<br>乙：靠，#%￥$%…</p>
<p> 很多的创业公司，一人身兼数职的情形还是很常见的。至少，我是经历过的，一个人包办了所有的开发过程，连测试我都做了，绝对的一条龙，但是经常踩钢丝、骑 独轮车总会有失足的时候，结果有一次，从我手里发出去的光盘母盘，含有病毒僵尸，以至于被迫收回已经推上市场的2万张光盘，从那之后，我的心脏就开始变得 无比坚强，现在就是整个后台服务都瘫痪了，我也只是微微一笑。其实，一个人身兼架构师和程序员，甚至多种角色，没什么不妥，后面还会讲这个话题，这种现象 不是中国特色，跟国外是完全接轨的。我曾经跟米国的一个工程师在msn中聊过类似的话题，发现他们的路子跟咱们没什么不同，在IT这个行业，我们跟世界的 差距只有1天，他们刚弄出来的新东西，我们这里第2天保准见得到。</p>
<p> 架构师这个称呼不是拍脑袋想出来的，是有国际标准（ISO/IEC 42010）可查的。架构师是软件开发活动中的众多角色之一，它可能是一个人、一个小组，也可能是一个团队。微软对架构师有一个分类参考，我们参考一下， 他们把架构师分为4种：企业架构师EA(Enterprise Architect)、基础结构架构师IA(Infrastructure Architect)、特定技术架构TSA(Technology-Specific Architect)和解决方案架构师SA (Solution Architect)。微软的这个分类是按照架构师专注的领域不同而划分的。</p>
<p> EA的职责是决定整个公司的技术路线和技术发展方向。盖茨给自己的Title就是首席软件架构师，网易丁磊也喜欢这么称呼自己，实际上就是EA角色；IA 的工作就是提炼和优化技术方面积累和沉淀形成的基础性的、公共的、可复用的框架和组件，这些都是一个技术型公司传承下来的最宝贵的财富之一；特定技术架构 师TSA，他们主要从事类似安全架构、存储架构等专项技术的规划和设计工作；SA的工作则专于解决方案的规划和设计，“解决方案”这个词在中国已经到了严 重泛滥的程度，大忽悠们最喜欢把它挂在嘴边。所谓解决方案，就是把产品、技术或理论，不断地进行组合，来创造出满足用户需求的选择。售前工程师一般都是带 着它到客户那里去发挥的。</p>
<p> 大公司会把各种类型的架构师分得很清楚，小公司一般就不那么讲究了，架构师多数是是IA+TSA+SA，一人包打天下，所以说大公司出专才，小公司出全才。</p>
<p> 实际工作中，我们也经常会见到另一种比较简单的分类方式，把架构师分为软件架构师和系统架构师。软件架构师基本上是TSA+IA，这也是程序员最容易突 破，最可能走上的一条道路，比如Java架构师、DotNet架构师、LAPM架构师等等，我后面所讲的内容都是与软件架构师的相关的话题。系统架构师实 际上是SA+TSA，更着力于综合运用已有的产品和技术，来实现客户期望的需求。系统架构师要求通晓软、硬件两方面的知识，所以它的知识体系相对庞杂。关 于系统架构师的话题，我们可以稍后再作讨论。</p>
<h4 id="3-2-架构师的职责"><a href="#3-2-架构师的职责" class="headerlink" title="3.2 架构师的职责"></a>3.2 架构师的职责</h4><p>架构师需要参与项目开发的全部过程，包括需求分析、架构设计、系统实现、集成、测试和部署各个阶段，负责在整个项目中对技术活动和技术说明进行指导和协调。<br>架构师主要职责有4条： </p>
<p>1、确认需求<br> 在项目开发过程中，架构师是在需求规格说明书完成后介入的，需求规格说明书必须得到架构师的认可。架构师需要和分析人员反复交流，以保证自己完整并准确地理解用户需求。</p>
<p>2、系统分解<br> 依据用户需求，架构师将系统整体分解为更小的子系统和组件，从而形成不同的逻辑层或服务。随后，架构师会确定各层的接口，层与层相互之间的关系。架构师不仅要对整个系统分层，进行“纵向”分解，还要对同一逻辑层分块，进行“横向”分解。<br> 软件架构师的功力基本体现于此，这是一项相对复杂的工作。</p>
<p>3、技术选型<br> 架构师通过对系统的一系列的分解，最终形成了软件的整体架构。技术选择主要取决于软件架构。<br>Web Server运行在Windows上还是Linux上？数据库采用MSSql、Oracle还是MySQL？需要不需要采用MVC或者spring等轻量级的框架？前端采用富客户端还是瘦客户端方式？类似的工作，都需要在这个阶段提出，并进行评估。<br>架构师对产品和技术的选型仅仅限于评估，没有决定权，最终的决定权归项目经理。架构师提出的技术方案为项目经理提供了重要的参考信息，项目经理会从项目预算、人力资源、时间进度等实际情况进行权衡，最终进行确认。</p>
<p>4、制定技术规格说明<br> 架构师在项目开发过程中，是技术权威。他需要协调所有的开发人员，与开发人员一直保持沟通，始终保证开发者依照它的架构意图去实现各项功能。<br> 架构师与开发者沟通的最重要的形式是技术规格说明书，它可以是UML视图、Word文档，Visio文件等各种表现形式。通过架构师提供的技术规格说明书，保证开发者可以从不同角度去观察、理解各自承担的子系统或者模块。<br>架构师不仅要保持与开发者的沟通，也需要与项目经理、需求分析员，甚至与最终用户保持沟通。所以，对于架构师来讲，不仅有技术方面的要求，还有人际交流方面的要求。</p>
<h4 id="3-3-架构师的误区"><a href="#3-3-架构师的误区" class="headerlink" title="3.3 架构师的误区"></a>3.3 架构师的误区</h4><p>1、架构师就是项目经理<br> 架构师不是项目经理。项目经理侧重于预算控制、时间进度控制、人员管理、与外部联系和协调等等工作，具备管理职能。一般小型项目中，常见项目经理兼架构师。</p>
<p>2、架构师负责需求分析<br> 架构师不是需求分析员。需求分析人员的工作是收集需求和分析需求，并与最终用户、产品经理保持联系。架构师只对最终的需求审核和确认，提出需求不清和不完整的部分，他会跟需求分析员时刻保持联系。架构师是技术专家，不是业务专家。</p>
<p>3、架构师从来不写代码<br> 这是一个尚存争论的问题。目前有两种观点：<br>观点1：架构师不写代码，写代码纯体力活，架构师写代码大材小用。架构师把UML的各种视图交给开发人员，如果有不明确的地方，可以与架构师随时沟通。<br>观点2：架构师本来自于程序员，只是比程序员站的层面更高，比程序员唯一多的是经验和知识，所以架构师也免不了写代码。<br> 我个人觉得这两种说法是与架构师的出身和所处的环境有关。<br> 架构师首先是一个技术角色，所以一定是来自于技术人员这个群体，比如系统架构师，多是来自于运维人员，可能本身代码写得并不多，或者说写不出来很漂亮的代 码。软件架构师多是来自于程序员，有着程序员的血统和情怀，所以在项目开发过程中，可能会写一些核心代码。我们的理想是架构师不用写代码，但事实上有时候 过于理想。架构师写不写代码，可能取决于公司的规模、文化、开发人员的素质等现实情况。另外，架构师也不是跟程序员界限分得那么清楚，按照能力也有高中低 之分，写不写代码不是区分两者的根本标准。</p>
<h4 id="3-4-架构师的基本素质"><a href="#3-4-架构师的基本素质" class="headerlink" title="3.4 架构师的基本素质"></a>3.4 架构师的基本素质</h4><p>周星驰有个片子《喜剧之王》，剧中的尹天仇整天揣着本《演员的自我修养》，一个好演员不仅需要天赋，也需要一定的理论指导，无师自通的人毕竟是少 数。架构师的成长过程也是这样。从普通程序员到高级程序员，再到架构师，是一个经验积累和思想升华的过程。经验积累是一个方面，素质培养是另一个方面，两 者相辅相成，所以我觉得有必要把架构师的所要具备的素质罗列一下，作为程序员努力的方向。</p>
<p>1、沟通能力<br> 为了提高效率，架构师必须赢得团队成员、项目经理、客户或用户认同，这就需要架构师具有较强的沟通能力。沟通能力是人类最普遍性的素质要求，技术人员好像 容易忽略，想成为架构师就不能忽略。千万不要抱着这样的观念：怀才跟怀孕似的，时间久了总会被人发现的。还是天桥上卖大力丸的哥们说得对：光说不练假把 式，光练不说傻把式。看看你周围的头头脑脑们，哪一个不是此中高手，我们千万不要鄙视，认为这是阿谀奉承、投机钻营，凡事都要看到积极的一面，“沟通”的 确是一种能力。我认为自己是一个略内向的人，因为我是农村出来的孩子，普通话都说不好，以前或多或少带有点自卑感，幻想着是金子总会发光，所以在职业生涯 中吃了不少亏。现在，我深深懂得了沟通的重要性，我会很主动地跟同事们，跟老大们不定时地沟通，感觉工作起来顺畅多了。</p>
<p> 这一条我认为最为重要，所以排在首位。我甚至认为下面几条都可以忽略，唯一这一条得牢记，而且要常常提醒自己。</p>
<p>2、领导能力<br>架构师能够推动整个团队的技术进展，能在压力下作出关键性的决策，并将其贯彻到底。架构师如何来保证这种执行力？这就需要架构师具有领导能力。</p>
<p> 架构师的领导能力的取得跟项目经理不太一样。项目经理主要负责解决行政管理，这种能力与技术关系不大，他有人权和财权，再扯上一张“领导”的虎皮，采用“ 胡萝卜加大棒”的方式，基本上可以保证执行力。架构师在项目里面可能更多地使用非正式的领导力，也就是我们常说的影响力，里面包括个人魅力、技术能力、知 识传递等等。</p>
<p>3、抽象思维和分析能力<br> 架构师必须具备抽象思维和分析的能力，这是你进行系统分析和系统分解的基本素质。只有具备这样的能力，架构师才能看清系统的整体，掌控全局，这也是架构师 大局观的形成基础。你如何具备这种能力呢？一是来自于经验，二是来自于学习。架构师不仅要具备在问题领域上的经验，也需要具备在软件工程领域内的经验。也 就是说，架构师必须能够准确得理解需求，然后用软件工程的思想，把需求转化和分解成可用计算机语言实现的程度。经验的积累是需要一个时间过程的，这个过程 谁也帮不了你，是需要你去经历的。但是，如果你有意识地去培养，不断吸取前人的经验的话，还是可以缩短这个周期的。这也是我写作此系列的始动力之一。</p>
<p>4、技术深度和广度</p>
<p>架构师最好精通1-2个技术，具备这种技术能力可以更加深入的理解有关架构的工作原理，也可以拉近和开发人员的距离，并形成团队中的影响力。</p>
<p>架构师的技术知识广度也很重要，需要了解尽可能多的技术，所谓见多识广，只有这样，才可能综合各种技术，选择更加适合项目的解决方案。有的人说，架构师技术广度的要求高于技术深度的要求，这是很有道理的。<br>总而言之，一句话：架构师是项目团队中的技术权威。</p>
<p>面向过程和面向对象这两个基本概念，不仅架构师需要非常清楚，程序员、设计师也要非常清楚，这也是系统分析、设计和编码最基本的常识。我接触的程序 员，很多人只停留在一种“似是而非”的程度，这是不行的，想要继续前进，就得把基础夯实，所以我觉得很有必要先回回炉，补补课。</p>
<h2 id="架构师之路-4-—详解面向对象"><a href="#架构师之路-4-—详解面向对象" class="headerlink" title="架构师之路(4)—详解面向对象"></a>架构师之路(4)—详解面向对象</h2><h3 id="3-5-详解面向对象的编程-OOP"><a href="#3-5-详解面向对象的编程-OOP" class="headerlink" title="3.5 详解面向对象的编程(OOP)"></a>3.5 详解面向对象的编程(OOP)</h3><h4 id="3-5-1-什么是面向对象"><a href="#3-5-1-什么是面向对象" class="headerlink" title="3.5.1 什么是面向对象"></a>3.5.1 什么是面向对象</h4><p> 刚接触编程的时候，多数人本能的反映可能是面向过程(OP)的，而不是面向对象(OO)的。这种现象其实是很正常的，改变思维方式是需要一个过程的，我大体归纳了一下其形成的原因：</p>
<p>1、直接原因<br> 你还没有养成面向对象分析问题和解决问题的习惯。建立面向对象的思维方式需要一定时间的训练和揣摩才能形成，所以你可以在学习或具体项目中刻意地强化这种意识。一般情况下，经过一段时间之后，你会觉得这是自然而然的事情，只有心中OO，眼中自然OO了。</p>
<p>2、历史原因<br> 我们从小接受的培训都是采用面向过程(OP)的方式分析问题和解决问题，尤其是数学，多数是强调按部就班的解决问题，计算机软件的发展一直就与数学是很有渊源，所以，顺理成章的，把面向过程(OP)的方式带入到软件开发也是很自然的事情。</p>
<p> 什么是面向对象，或者谈谈你对面向对象的理解，这恐怕是软件开发人员，尤其是程序员和设计师应聘的时候，面试官常最挂在嘴边的问题吧。面向对象对应的英文 是Object-Oriented，把Object-Oriented翻译成“面向对象”，我一直觉得这个译法不太确切，因为多数人第一次看到“面向对象 ”这四个字，都很难从字面上理解它到底是什么意思。后来，我又查阅了一些有关的资料，发现港澳台的计算机书籍中是把它翻译成了“物件导向”，这个译法，我 感觉不错，于我心颇有些戚戚焉。“物件导向”比较准确地反映了面向对象认识和解决问题都是要围绕对象展开的。</p>
<p>所以，面向对象的思维方式认为：软件系统是一组交互的对象的集合。一组相关的对象组合为一个子系统，一组子系统继续组合为更复杂的子系统，直至组合成整个系统。</p>
<p> 面向对象方式的出发点是尽可能模拟人类习惯的思维方式，将“问题域”中涉及的内容抽象为“对象”，使软件开发的方法与过程尽可能接近人类认识世界解决问题的方法与过程。</p>
<p> 面向过程就是分析出解决问题所需要的步骤，然后用函数把这些步骤一步一步实现，使用的时候一个一个依次调用就可以了。面向对象是把构成问题事务分解成各个对象，建立对象的目的不是为了完成一个步骤，而是为了描叙某个事物在整个解决问题的步骤中的行为。</p>
<p> 面向过程认识和解决问题的思维，可以称为“流程论”，重点放在处理过程的步骤，流程是整个系统的核心。</p>
<p> 面向对象认识和解决问题的思维，可以称为“组装论”，重心放在对象的抽象和提取上，然后将对象组装为整体。</p>
<p>所以OO和OP从思维方式来讲，出发点还是完全不同的。</p>
<h4 id="3-5-2-OP-PK-OO"><a href="#3-5-2-OP-PK-OO" class="headerlink" title="3.5.2 OP PK OO"></a>3.5.2 OP PK OO</h4><p> 咱们用象棋对战的例子，来比较OP和OO的不同：</p>
<p> <img src="http://ojlt0g866.bkt.clouddn.com/blog/20170424/085852324.png" alt="mark"></p>
<p> 采用面向过程(OPP)的设计思路，首先分拆整个对战过程，分析双方对战的步骤，得到如下流程：</p>
<p><img src="http://ojlt0g866.bkt.clouddn.com/blog/20170424/085927058.png" alt="mark"></p>
<p> 把上面每个步骤分别用函数进行实现，问题就解决了。</p>
<p> 我们再来看看面向对象是如何来解决问题，整个象棋游戏可以抽象出3种对象：<br>1、棋手，负责行棋，这两者行为一致。<br>2、棋盘，负责绘制棋盘画面。<br>3、裁判，负责判定诸如吃子、犯规和输赢。</p>
<p> 三者之间的关系如下：<br><img src="http://ojlt0g866.bkt.clouddn.com/blog/20170424/085940886.png" alt="mark"></p>
<p> 第一类对象棋手负责行棋，并告知第二类对象棋盘中棋子布局的变化，棋盘接收到了棋子布局的变化后，负责在绘制屏幕，同时利用第三类对象裁判来对棋局进行判定。<br>从以上两种的实现方式可以看出几点：</p>
<p>1、可维护性<br> 面向对象是以数据和功能来划分问题，而不是依据流程和步骤。同样是绘制棋盘的行为，在面向过程的设计中分散在了很多的步骤中，很可能出现在不同的绘制版本 中，只是不是很像一份“蛋炒饭”中的鸡蛋？在面向对象的设计中，绘图只可能在棋盘对象中出现，从而保证了绘图的统一，这就是把鸡蛋从“蛋炒饭”中分离出来 的效果。</p>
<p>2、可扩展性<br> 假如我要加入悔棋的功能，如果要改动面向过程的设计，那么从行棋到显示再到判定这一连串的步骤都要改动，甚至步骤之间的循序都要进行大规模调整。如果是面 向对象的话，只用改动棋盘对象就行了，棋盘对象保存了双方的棋谱，简单回溯，减一就可以了，而显示和判定不涉及，同时整体对各个对象功能的调用顺序都没有 变化，改动只限定在了局部。</p>
<h4 id="3-5-3-OO的深层思考"><a href="#3-5-3-OO的深层思考" class="headerlink" title="3.5.3 OO的深层思考"></a>3.5.3 OO的深层思考</h4><p> OO认为：软件系统是一组交互的对象的集合。<br> 因为人类对现实世界是非常熟悉的，所以OO就是通过抽象的方式，把问题域映射到现实世界，尽量模拟现实世界的万事万物。通过这种方式，就可以运用现实世界中解决问题的方法与过程，来解决软件领域内的问题。<br>有人说：OO眼里一切皆对象，这句话还是很有道理的。<br>OO到底给软件开发带来了什么样的好处？OO的抽象的尺度是如何把握的呢？这都是问题。</p>
<h2 id="架构师之路-5-—面向对象的设计原则"><a href="#架构师之路-5-—面向对象的设计原则" class="headerlink" title="架构师之路(5)—面向对象的设计原则"></a>架构师之路(5)—面向对象的设计原则</h2><h3 id="1-OO的设计原则"><a href="#1-OO的设计原则" class="headerlink" title="1 OO的设计原则"></a>1 OO的设计原则</h3><p> 采用面向对象的分析和设计思想，为我们分析和解决问题提供了一种全新的思维方式。我们在拿到需求之后(略去OOA，以后补全)，接下来的问题就是：如何对系统进行面向对象的设计呢？<br> 按照软件工程的理论，面向对象的设计要解决的核心问题就是可维护性和可复用性，尤其是可维护性，它是影响软件生命周期重要因素。通常情况下，软件的维护成本远远大于初期开发成本。<br> 一个可维护性很差的软件设计，人们通常称之为“臭味”的，形成的原因主要有这么几个：过于僵硬、过于脆弱、复用率低或者黏度过高。相反，一个好的系统设计 应该是灵活的、可扩展的、可复用的、可插拔的。在20世纪80到90年代，很多业内专家不断探索面向对象的软件设计方法，陆续提出了一些设计原则。这些设 计原则能够显著地提高系统的可维护性和可复用性，成为了我们进行面向对象设计的指导原则：</p>
<p>1、单一职责原则SRP<br> 每一个类应该专注于做一件事情。</p>
<p>2、“开-闭”原则OCP<br> 每一个类应该是对扩展开放，对修改关闭。</p>
<p>3、 里氏代换原则LSP<br> 避免造成派生类的方法非法或退化，一个基类的用户应当不需要知道这个派生类。</p>
<p>4、 依赖倒转原则DIP<br> 用依赖于接口和抽象类来替代依赖容易变化的具体类。</p>
<p>5、 接口隔离原则ISP<br> 应当为客户提供尽可能小的接口，而不是提供大的接口。</p>
<p>其中，“开-闭”原则是面向对象的可复用设计的基石，其他设计原则（里氏代换原则、依赖倒转原则、合成/聚合复用原则、迪米特法则、接口隔离原则）是实现“开-闭”原则的手段和工具。<br>我会为大家一一进行讲解。</p>
<h3 id="2-单一职责原则SRP-Single-Responsibility-Principle"><a href="#2-单一职责原则SRP-Single-Responsibility-Principle" class="headerlink" title="2 单一职责原则SRP(Single-Responsibility Principle)"></a>2 单一职责原则SRP(Single-Responsibility Principle)</h3><h4 id="2-1-什么是单一职责"><a href="#2-1-什么是单一职责" class="headerlink" title="2.1 什么是单一职责"></a>2.1 什么是单一职责</h4><p> 单一职责就是指一个类应该专注于做一件事。现实生活中也存在诸如此类的问题：“一个人可能身兼数职，甚至于这些职责彼此关系不大，那么他可能无法做好所有职责内的事情，所以，还是专人专管比较好。”我们在设计类的时候，就应该遵循这个单一职责原则。</p>
<p> 记得有人比喻过软件开发、设计原则、设计模式之间的关系就是战争、战略和战术的关系，关于设计模式实际上是设计原则的具体应用，以后我们还会讲到这一点。另外，大家都很熟悉计算器的例子，很多的人都愿意以此为例，我们也以计算器编程为例说明单一职责原则：<br> 在有些人眼里，计算器就是一件东西，是一个整体，所以它把这个需求进行了抽象，最终设计为一个Calculator类，代码如下：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div></pre></td><td class="code"><pre><div class="line">class Calculator&#123;</div><div class="line">  public String calculate() &#123;</div><div class="line"></div><div class="line"> Console.Write("Please input the first number:");</div><div class="line"> String strNum1 = Console.ReadLine();</div><div class="line">  </div><div class="line"> Console.Write(Please input the operator:");</div><div class="line"> String strOpr= Console.ReadLine();</div><div class="line"></div><div class="line"> Console.Write("Please input the second number:");</div><div class="line"> String strNum2 = Console.ReadLine();</div><div class="line"></div><div class="line"> String strResult = "";</div><div class="line"> if (strOpr == "+")&#123;</div><div class="line">strResult = Convert.ToString(Convert.ToDouble(strNum1) + Convert.ToDouble(strNum2));</div><div class="line"> &#125;</div><div class="line"> else if (strOpr == "-")&#123;</div><div class="line">strResult = Convert.ToString(Convert.ToDouble(strNum1) - Convert.ToDouble(strNum2));</div><div class="line"> &#125;</div><div class="line"> else if (strOpr == "*")&#123;</div><div class="line">strResult = Convert.ToString(Convert.ToDouble(strNum1) * Convert.ToDouble(strNum2));</div><div class="line"> &#125;</div><div class="line"> else if (strOpr == "/")&#123;</div><div class="line">strResult = Convert.ToString(Convert.ToDouble(strNum1) / Convert.ToDouble(strNum2));</div><div class="line"> &#125;</div><div class="line"></div><div class="line"> Console.WriteLine("The result is " + strResult);</div><div class="line">  &#125;  </div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>另外，还有一部分人认为：计算器是一个外壳和一个处理器的组合。</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div></pre></td><td class="code"><pre><div class="line">class Appearance&#123;</div><div class="line">  public int displayInput(String &amp;strNum1,String &amp;strOpr, String &amp;strNum2) &#123;</div><div class="line"> Console.Write("Please input the first number:");</div><div class="line"> strNum1 = Console.ReadLine();</div><div class="line"> </div><div class="line"> Console.Write(Please input the operator:");</div><div class="line"> strOpr= Console.ReadLine();</div><div class="line"></div><div class="line"> </div><div class="line"></div><div class="line"> Console.Write("Please input the second number:");</div><div class="line"> strNum2 = Console.ReadLine();</div><div class="line"></div><div class="line"> </div><div class="line"></div><div class="line"> return 0;</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  public String displayOutput(String strResult) &#123;</div><div class="line"> Console.WriteLine("The result is " + strResult);</div><div class="line">  &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"> </div><div class="line"></div><div class="line">class Processor&#123;</div><div class="line">  public String calculate(String strNum1,String strOpr, String strNum2)&#123;</div><div class="line"> String strResult = "";</div><div class="line"> if (strOpr == "+")&#123;</div><div class="line">strResult = Convert.ToString(Convert.ToDouble(strNum1) + Convert.ToDouble(strNum2));</div><div class="line"> &#125;</div><div class="line"> else if (strOpr == "-")&#123;</div><div class="line">strResult = Convert.ToString(Convert.ToDouble(strNum1) - Convert.ToDouble(strNum2));</div><div class="line"> &#125;</div><div class="line"> else if (strOpr == "*")&#123;</div><div class="line">strResult = Convert.ToString(Convert.ToDouble(strNum1) * Convert.ToDouble(strNum2));</div><div class="line"> &#125;</div><div class="line"> else if (strOpr == "/")&#123;</div><div class="line">strResult = Convert.ToString(Convert.ToDouble(strNum1) / Convert.ToDouble(strNum2));</div><div class="line"> &#125;</div><div class="line"> return strResult;</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>为什么这么做呢？因为外壳和处理器是两个职责，是两件事情，而且都是很容易发生需求变动的因素，所以把它们放到一个类中，违背了单一职责原则。<br> 比如，用户可能对计算器提出以下要求：<br> 第一，目前已经实现了“加法”、“减法”、“乘法”和“除法”，以后还可能出现“乘方”、“开方”等很多运算。<br> 第二，现在人机界面太简单了，还可能做个Windows计算器风格的界面或者Mac计算器风格的界面。<br>所以，把一个类Calculator 拆分为两个类Appearance和Processor，一个类做一件事情，这样更容易应对需求变化。如果界面需要修改，那么就去修改Appearance类；如果处理器需要修改，那么就去修改Processor类。</p>
<p> 我们再举一个邮件的例子。我们平常收到的邮件内容，看起来是一封信，实际上内部有两部分组成：邮件头和邮件体。电子邮件的编码要求符合RFC822标准。<br>第一种设计方式是这样：<br>interface IEmail {<br> public void setSender(String sender);<br> public void setReceiver(String receiver);<br> public void setContent(String content);<br>}</p>
<p>class Email implements IEmail {<br> public void setSender(String sender) {// set sender; }<br> public void setReceiver(String receiver) {// set receiver; }<br> public void setContent(String content) {// set content; }<br>}</p>
<p>这个设计是有问题的，因为邮件头和邮件体都有变化的可能性。<br>1、邮件头的每一个域的编码，可能是BASE64，也可能是QP，而且域的数量也不固定。<br>2、邮件体中封装的邮件内容可能是PlainText类型,也可能是HTML类型，甚至于流媒体。<br>所谓第一种设计方式违背了单一职责原则，里面封装了两种可能引起变化的原因。<br>我们依照单一职责原则，对其进行改进后，变为第二种设计方式：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">interface</span> <span class="title">IEmail</span> </span>&#123;</div><div class="line">  <span class="keyword">public</span> void setSender(String sender);</div><div class="line">  <span class="keyword">public</span> void setReceiver(String receiver);</div><div class="line">  <span class="keyword">public</span> void setContent(IContent content);</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">interface</span> <span class="title">IContent</span> </span>&#123;</div><div class="line">  <span class="keyword">public</span> String getAsString();</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Email</span> <span class="keyword">implements</span> <span class="title">IEmail</span> </span>&#123;</div><div class="line">  <span class="keyword">public</span> void setSender(String sender) &#123;<span class="comment">// set sender; &#125; </span></div><div class="line">  <span class="keyword">public</span> void setReceiver(String receiver) &#123;<span class="comment">// set receiver; &#125; </span></div><div class="line">  <span class="keyword">public</span> void setContent(IContent content) &#123;<span class="comment">// set content; &#125;</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>有的资料把单一职责解释为：“仅有一个引起它变化的原因”。这个解释跟“专注于做一件事”是等价的。如果一个类同时做两件事情，那么这两件事情都有可能引起它的变化。同样的道理，如果仅有一个引起它变化的原因，那么这个类也就只能做一件事情。</p>
<h3 id="2-2-单一职责原则的使用"><a href="#2-2-单一职责原则的使用" class="headerlink" title="2.2 单一职责原则的使用"></a>2.2 单一职责原则的使用</h3><p> 单一职责原则的尺度如何掌握？我们怎么能知道该拆分还是不应该拆分呢？原则很简单：需求决定。如果你所需要的计算器，永远都没有外观和处理器变动的可能 性，那么就应该把它抽象为一个整体的计算器；如果你所需要的计算器，外壳和处理器都有可能发生变动，那么就必须把它拆离为外壳和处理器。<br>单一职责 原则实际上是把相同的职责进行了聚合，避免把相同的职责分散到不同的类之中，这样就可以控制变化，把变化限制在一个地方，防止因为一个地方的变动，引起更 多地方的变动的“涟漪效应”，单一职责原则避免一个类承担过多的职责。单一职责原则不是说一个类就只有一个方法，而是具有单一功能。<br> 我们在使用单一职责原则的时候，牢记以下几点：<br>A、一个设计合理的类，应该仅有一个可以引起它变化的原因，即单一职责，如果有多个原因可以引起它的变化，就必须进行分离；<br>B、在没有需求变化征兆的情况下，应用单一职责原则或其他原则是不明智的，因为这样会使系统变得很复杂，系统将会变成一堆细小的颗粒组成，纯属于没事找抽；<br>C、在需求能够预计或实际发生变化时，就应该使用单一职责原则来重构代码，有经验的设计师、架构师对可能出现的需求变化很敏感，设计上就会具有一定的前瞻性。</p>
<h2 id="架构师之路-6-—OOD的开闭原则"><a href="#架构师之路-6-—OOD的开闭原则" class="headerlink" title="架构师之路(6)—OOD的开闭原则"></a>架构师之路(6)—OOD的开闭原则</h2><h3 id="2-开闭原则（Open-Closed-Principle-OCP）"><a href="#2-开闭原则（Open-Closed-Principle-OCP）" class="headerlink" title="2 开闭原则（Open-Closed Principle,OCP）"></a>2 开闭原则（Open-Closed Principle,OCP）</h3><h4 id="2-1-什么是开闭原则"><a href="#2-1-什么是开闭原则" class="headerlink" title="2.1 什么是开闭原则"></a>2.1 什么是开闭原则</h4><p> 开闭原则是面向对象设计中“可复用设计”的基石，是面向对象设计中最重要的原则之一，其它很多的设计原则都是实现开闭原则的一种手段。</p>
<p> 1988年，Bertrand Meyer在他的著作《Object Oriented Software Construction》中提出了开闭原则，它的原文是这样：“Software entities should be open for extension,but closed for modification”。翻译过来就是：“软件实体应当对扩展开放，对修改关闭”。这句话说得略微有点专业，我们把它讲得更通俗一点，也就是：软件系统中包含的各种组件，例如模块（Modules）、类（Classes）以及功能（Functions）等等，应该在不修改现有代码的基础上，引入新功能。开闭原则中“开”，是指对于组件功能的扩展是开放的，是允许对其进行功能扩展的；开闭原则中“闭”，是指对于原有代码的修改是封闭的，即不应该修改原有的代码。</p>
<h4 id="2-2-如何实现开闭原则"><a href="#2-2-如何实现开闭原则" class="headerlink" title="2.2 如何实现开闭原则"></a>2.2 如何实现开闭原则</h4><p> 实现开闭原则的关键就在于“抽象”。把系统的所有可能的行为抽象成一个抽象底层，这个抽象底层规定出所有的具体实现必须提供的方法的特征。作为系统设计的抽象层，要预见所有可能的扩展，从而使得在任何扩展情况下，系统的抽象底层不需修改；同时，由于可以从抽象底层导出一个或多个新的具体实现，可以改变系统的行为，因此系统设计对扩展是开放的。</p>
<p> 我们在软件开发的过程中，一直都是提倡需求导向的。这就要求我们在设计的时候，要非常清楚地了解用户需求，判断需求中包含的可能的变化，从而明确在什么情况下使用开闭原则。</p>
<p> 关于系统可变的部分，还有一个更具体的对可变性封装原则（Principle of Encapsulation of Variation,  EVP），它从软件工程实现的角度对开闭原则进行了进一步的解释。EVP要求在做系统设计的时候，对系统所有可能发生变化的部分进行评估和分类，每一个可变的因素都单独进行封装。</p>
<p> 我们在实际开发过程的设计开始阶段，就要罗列出来系统所有可能的行为，并把这些行为加入到抽象底层，根本就是不可能的，这么去做也是不经济的，费时费力。另外，在设计开始阶段，对所有的可变因素进行预计和封装也不太现实，也是很难做得到。所以，开闭原则描绘的愿景只是一种理想情况或是极端状态，现实世界中是很难被完全实现的。我们只能在某些组件，在某种程度上符合开闭原则的要求。</p>
<p> 通过以上的分析，对于开闭原则，我们可以得出这样的结论：虽然我们不可能做到百分之百的封闭，但是在系统设计的时候，我们还是要尽量做到这一点。</p>
<p> 对于软件系统的功能扩展，我们可以通过继承、重载或者委托等手段实现。以接口为例，它对修改就是是封闭的，而对具体的实现是开放的，我们可以根据实际的需要提供不同的实现，所以接口是符合开闭原则的。</p>
<h4 id="2-3-开闭原则能够带来什么好处"><a href="#2-3-开闭原则能够带来什么好处" class="headerlink" title="2.3 开闭原则能够带来什么好处"></a>2.3 开闭原则能够带来什么好处</h4><p> 如果一个软件系统符合开闭原则的，那么从软件工程的角度来看，它至少具有这样的好处：</p>
<p> 可复用性好。</p>
<p> 我们可以在软件完成以后，仍然可以对软件进行扩展，加入新的功能，非常灵活。因此，这个软件系统就可以通过不断地增加新的组件，来满足不断变化的需求。</p>
<p> 可维护性好。</p>
<p> 由于对于已有的软件系统的组件，特别是它的抽象底层不去修改，因此，我们不用担心软件系统中原有组件的稳定性，这就使变化中的软件系统有一定的稳定性和延续性。</p>
<h4 id="2-4-开闭原则与其它原则的关系"><a href="#2-4-开闭原则与其它原则的关系" class="headerlink" title="2.4 开闭原则与其它原则的关系"></a>2.4 开闭原则与其它原则的关系</h4><p> 开闭原则具有理想主义的色彩，它是面向对象设计的终极目标。因此，针对开闭原则的实现方法，一直都有面向对象设计的大师费尽心机，研究开闭原则的实现方式。后面要提到的里氏代换原则（LSP）、依赖倒转原则（DIP）、接口隔离原则（ISP）以及抽象类（Abstract Class）、接口(Interace)等等，都可以看作是开闭原则的实现方法。</p>
<h2 id="架构师之路-7-—里氏代换原则"><a href="#架构师之路-7-—里氏代换原则" class="headerlink" title="架构师之路(7)—里氏代换原则"></a>架构师之路(7)—里氏代换原则</h2><h3 id="4-里氏代换原则（Liskov-Substitution-Principle-LSP）"><a href="#4-里氏代换原则（Liskov-Substitution-Principle-LSP）" class="headerlink" title="4 里氏代换原则（Liskov Substitution Principle, LSP）"></a>4 里氏代换原则（Liskov Substitution Principle, LSP）</h3><h4 id="4-1-什么是里氏代换原则"><a href="#4-1-什么是里氏代换原则" class="headerlink" title="4.1 什么是里氏代换原则"></a>4.1 什么是里氏代换原则</h4><p> 里氏代换原则是由麻省理工学院（MIT）计算机科学实验室的Liskov女士，在1987年的OOPSLA大会上发表的一篇文章《Data Abstraction and Hierarchy》里面提出来的，主要阐述了有关继承的一些原则，也就是什么时候应该使用继承，什么时候不应该使用继承，以及其中的蕴涵的原理。2002年，我们前面单一职责原则中提到的软件工程大师Robert C. Martin，出版了一本《Agile Software Development Principles Patterns and Practices》，在文中他把里氏代换原则最终简化为一句话：“Subtypes must be substitutable for their base types”。也就是，子类必须能够替换成它们的基类。<br> 我们把里氏代换原则解释得更完整一些：在一个软件系统中，子类应该可以替换任何基类能够出现的地方，并且经过替换以后，代码还能正常工作。</p>
<h4 id="4-2-第一个例子：正方形不是长方形"><a href="#4-2-第一个例子：正方形不是长方形" class="headerlink" title="4.2 第一个例子：正方形不是长方形"></a>4.2 第一个例子：正方形不是长方形</h4><p> “正方形不是长方形”是一个理解里氏代换原则的最经典的例子。在数学领域里，正方形毫无疑问是长方形，它是一个长宽相等的长方形。所以，我们开发的一个与几何图形相关的软件系统中，让正方形继承自长方形是顺利成章的事情。现在，我们截取该系统的一个代码片段进行分析：<br>长方形类Rectangle:</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Rectangle</span> </span>&#123;</div><div class="line">  double length;</div><div class="line">  double width;</div><div class="line">  <span class="keyword">public</span> double getLength() &#123; <span class="keyword">return</span> length; &#125; </div><div class="line">  <span class="keyword">public</span> void setLength(double height) &#123; this.length = length; &#125;</div><div class="line">  <span class="keyword">public</span> double getWidth() &#123; <span class="keyword">return</span> width; &#125;</div><div class="line">  <span class="keyword">public</span> void setWidth(double width) &#123; this.width = width; &#125; </div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>正方形类Square:</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Square</span> <span class="keyword">extends</span> <span class="title">Rectangle</span> </span>&#123;</div><div class="line">  <span class="keyword">public</span> void setWidth(double width) &#123;</div><div class="line"> super.setLength(width);</div><div class="line"> super.setWidth(width);</div><div class="line"> &#125;</div><div class="line">  <span class="keyword">public</span> void setLength(double length) &#123; </div><div class="line"> super.setLength(length);</div><div class="line"> super.setWidth(length);</div><div class="line">  &#125; </div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p> 由于正方形的度和宽度必须相等，所以在方法setLength和setWidth中，对长度和宽度赋值相同。类TestRectangle是我们的软件系统中的一个组件，它有一个resize方法要用到基类Rectangle，resize方法的功能是模拟长方形宽度逐步增长的效果:<br>  测试类TestRectangle：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">TestRectangle</span> </span>&#123;</div><div class="line">  <span class="keyword">public</span> void resize(Rectangle objRect) &#123;</div><div class="line"> <span class="keyword">while</span>(objRect.getWidth() &lt;= objRect.getLength()  ) &#123;</div><div class="line">  objRect.setWidth(  objRect.getWidth () + <span class="number">1</span> );</div><div class="line"> &#125;</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p> 我们运行一下这段代码就会发现，假如我们把一个普通长方形作为参数传入resize方法，就会看到长方形宽度逐渐增长的效果，当宽度大于长度,代码就会停止，这种行为的结果符合我们的预期；假如我们再把一个正方形作为参数传入resize方法后，就会看到正方形的宽度和长度都在不断增长，代码会一直运行下去，直至系统产生溢出错误。所以，普通的长方形是适合这段代码的，正方形不适合。<br> 我们得出结论：在resize方法中，Rectangle类型的参数是不能被Square类型的参数所代替，如果进行了替换就得不到预期结果。因此，Square类和Rectangle类之间的继承关系违反了里氏代换原则，它们之间的继承关系不成立，正方形不是长方形。</p>
<p>####　4.3 第二个例子：鸵鸟不是鸟</p>
<p> “鸵鸟非鸟”也是一个理解里氏代换原则的经典的例子。“鸵鸟非鸟”的另一个版本是“企鹅非鸟”，这两种说法本质上没有区别，前提条件都是这种鸟不会飞。生物学中对于鸟类的定义：“恒温动物，卵生，全身披有羽毛，身体呈流线形，有角质的喙，眼在头的两侧。前肢退化成翼，后肢有鳞状外皮，有四趾”。所以，从生物学角度来看，鸵鸟肯定是一种鸟。<br>我们设计一个与鸟有关的系统，鸵鸟类顺理成章地由鸟类派生，鸟类所有的特性和行为都被鸵鸟类继承。大多数的鸟类在人们的印象中都是会飞的，所以，我们给鸟类设计了一个名字为fly的方法，还给出了与飞行相关的一些属性,比如飞行速度（velocity）。<br>  鸟类Bird:</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Bird</span> </span>&#123;</div><div class="line">double velocity;</div><div class="line"><span class="keyword">public</span> fly() &#123; <span class="comment">//I am flying; &#125;;</span></div><div class="line"></div><div class="line"><span class="keyword">public</span> setVelocity(double velocity) &#123; this.velocity = velocity; &#125;;</div><div class="line"><span class="keyword">public</span> getVelocity() &#123; <span class="keyword">return</span> this.velocity; &#125;;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p> 鸵鸟不会飞怎么办？我们就让它扇扇翅膀表示一下吧，在fly方法里什么都不做。至于它的飞行速度，不会飞就只能设定为0了，于是我们就有了鸵鸟类的设计。<br>鸵鸟类Ostrich:</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Ostrich</span> <span class="keyword">extends</span> <span class="title">Bird</span> </span>&#123;</div><div class="line"> <span class="keyword">public</span> fly() &#123; <span class="comment">//I do nothing; &#125;;</span></div><div class="line"> <span class="keyword">public</span> setVelocity(double velocity) &#123; this.velocity = <span class="number">0</span>; &#125;;</div><div class="line"><span class="keyword">public</span> getVelocity() &#123; <span class="keyword">return</span> <span class="number">0</span>; &#125;;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p> 好了，所有的类都设计完成，我们把类Bird提供给了其它的代码（消费者）使用。现在，消费者使用Bird类完成这样一个需求：计算鸟飞越黄河所需的时间。<br> 对于Bird类的消费者而言，它只看到了Bird类中有fly和getVelocity两个方法，至于里面的实现细节，它不关心，而且也无需关心，于是给出了实现代码：<br>测试类TestBird:</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">TestBird</span> </span>&#123;</div><div class="line"><span class="keyword">public</span> calcFlyTime(Bird bird) &#123;</div><div class="line"><span class="keyword">try</span>&#123;</div><div class="line">  double riverWidth = <span class="number">3000</span>;</div><div class="line">  System.out.println(riverWidth / bird.getVelocity());</div><div class="line">&#125;<span class="keyword">catch</span>(<span class="keyword">Exception</span> err)&#123;</div><div class="line">  System.out.println(<span class="string">"An error occured!"</span>);</div><div class="line">&#125;</div><div class="line">&#125;;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p> 如果我们拿一种飞鸟来测试这段代码，没有问题，结果正确，符合我们的预期，系统输出了飞鸟飞越黄河的所需要的时间；如果我们再拿鸵鸟来测试这段代码，结果代码发生了系统除零的异常，明显不符合我们的预期。<br> 对于TestBird类而言，它只是Bird类的一个消费者，它在使用Bird类的时候，只需要根据Bird类提供的方法进行相应的使用，根本不会关心鸵鸟会不会飞这样的问题，而且也无须知道。它就是要按照“所需时间 = 黄河的宽度 / 鸟的飞行速度”的规则来计算鸟飞越黄河所需要的时间。<br> 我们得出结论：在calcFlyTime方法中，Bird类型的参数是不能被Ostrich类型的参数所代替，如果进行了替换就得不到预期结果。因此，Ostrich类和Bird类之间的继承关系违反了里氏代换原则，它们之间的继承关系不成立，鸵鸟不是鸟。</p>
<h4 id="4-4-鸵鸟到底是不是鸟"><a href="#4-4-鸵鸟到底是不是鸟" class="headerlink" title="4.4 鸵鸟到底是不是鸟?"></a>4.4 鸵鸟到底是不是鸟?</h4><p> “鸵鸟到底是不是鸟”，鸵鸟是鸟也不是鸟，这个结论似乎就是个悖论。产生这种混乱有两方面的原因：<br>原因一：对类的继承关系的定义没有搞清楚。<br> 面向对象的设计关注的是对象的行为，它是使用“行为”来对对象进行分类的，只有行为一致的对象才能抽象出一个类来。我经常说类的继承关系就是一种“Is-A”关系，实际上指的是行为上的“Is-A”关系，可以把它描述为“Act-As”。关于类的继承的细节，我们可以单独再讲。<br> 我们再来看“正方形不是长方形”这个例子，正方形在设置长度和宽度这两个行为上，与长方形显然是不同的。长方形的行为：设置长方形的长度的时候，它的宽度保持不变，设置宽度的时候，长度保持不变。正方形的行为：设置正方形的长度的时候，宽度随之改变；设置宽度的时候，长度随之改变。所以，如果我们把这种行为加到基类长方形的时候，就导致了正方形无法继承这种行为。我们“强行”把正方形从长方形继承过来，就造成无法达到预期的结果。<br> “鸵鸟非鸟”基本上也是同样的道理。我们一讲到鸟，就认为它能飞，有的鸟确实能飞，但不是所有的鸟都能飞。问题就是出在这里。如果以“飞”的行为作为衡量“鸟”的标准的话，鸵鸟显然不是鸟；如果按照生物学的划分标准：有翅膀、有羽毛等特性作为衡量“鸟”的标准的话，鸵鸟理所当然就是鸟了。鸵鸟没有“飞”的行为，我们强行给它加上了这个行为，所以在面对“飞越黄河”的需求时，代码就会出现运行期故障。</p>
<p>原因二：设计要依赖于用户要求和具体环境。<br> 继承关系要求子类要具有基类全部的行为。这里的行为是指落在需求范围内的行为。图中鸟类具有4个对外的行为，其中2个行为分别落在A和B系统需求中：</p>
<p> <img src="http://ojlt0g866.bkt.clouddn.com/blog/20170424/091805030.png" alt="mark"></p>
<p>系统需求和对象关系示意图</p>
<p> A需求期望鸟类提供与飞翔有关的行为，即使鸵鸟跟普通的鸟在外观上就是100%的相像，但在A需求范围内，鸵鸟在飞翔这一点上跟其它普通的鸟是不一致的，它没有这个能力，所以，鸵鸟类无法从鸟类派生，鸵鸟不是鸟。<br> B需求期望鸟类提供与羽毛有关的行为，那么鸵鸟在这一点上跟其它普通的鸟一致的。虽然它不会飞，但是这一点不在B需求范围内，所以，它具备了鸟类全部的行为特征，鸵鸟类就能够从鸟类派生，鸵鸟就是鸟。</p>
<p> 所有派生类的行为功能必须和使用者对其基类的期望保持一致，如果派生类达不到这一点，那么必然违反里氏替换原则。在实际的开发过程中，不正确的派生关系是非常有害的。伴随着软件开发规模的扩大，参与的开发人员也越来越多，每个人都在使用别人提供的组件，也会为别人提供组件。最终，所有人的开发的组件经过层层包装和不断组合，被集成为一个完整的系统。每个开发人员在使用别人的组件时，只需知道组件的对外裸露的接口，那就是它全部行为的集合，至于内部到底是怎么实现的，无法知道，也无须知道。所以，对于使用者而言，它只能通过接口实现自己的预期，如果组件接口提供的行为与使用者的预期不符，错误便产生了。里氏代换原则就是在设计时避免出现派生类与基类不一致的行为。</p>
<h3 id="4-5-如何正确地运用里氏代换原则"><a href="#4-5-如何正确地运用里氏代换原则" class="headerlink" title="4.5 如何正确地运用里氏代换原则"></a>4.5 如何正确地运用里氏代换原则</h3><p>里氏代换原则目的就是要保证继承关系的正确性。我们在实际的项目中，是不是对于每一个继承关系都得费这么大劲去斟酌？不需要，大多数情况下按照“Is-A”去设计继承关系是没有问题的，只有极少的情况下，需要你仔细处理一下，这类情况对于有点开发经验的人，一般都会觉察到，是有规律可循的。最典型的就是使用者的代码中必须包含依据子类类型执行相应的动作的代码：<br>动物类Animal：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Animal</span></span>&#123;</div><div class="line">  String name;</div><div class="line">  <span class="keyword">public</span> Animal(String name) &#123;</div><div class="line"> this.name = name;</div><div class="line"> &#125;</div><div class="line">  <span class="keyword">public</span> void printName()&#123;</div><div class="line">  <span class="keyword">try</span>&#123;</div><div class="line">  System.out.println(<span class="string">"I am a "</span> + name + <span class="string">"!"</span>);</div><div class="line">  &#125;<span class="keyword">catch</span>(<span class="keyword">Exception</span> err)&#123;</div><div class="line">  System.out.println(<span class="string">"An error occured!"</span>);</div><div class="line">  &#125;</div><div class="line">&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>猫类Cat：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Cat</span> <span class="keyword">extends</span> <span class="title">Animal</span></span>&#123;</div><div class="line">  <span class="keyword">public</span> Cat(String name)&#123;</div><div class="line"> super(name);</div><div class="line">  &#125;</div><div class="line">  <span class="keyword">public</span> void Mew()&#123;</div><div class="line">  <span class="keyword">try</span>&#123;</div><div class="line"> System.out.println(<span class="string">"Mew~~~ "</span>);</div><div class="line">  &#125;<span class="keyword">catch</span>(<span class="keyword">Exception</span> err)&#123;</div><div class="line"> System.out.println(<span class="string">"An error occured!"</span>);</div><div class="line">  &#125;</div><div class="line"> &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>狗类Dog：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Dog</span> <span class="keyword">extends</span> <span class="title">Animal</span> </span>&#123;</div><div class="line">  <span class="keyword">public</span> Dog(String name) &#123;</div><div class="line"> super(name);</div><div class="line"> &#125;</div><div class="line"> <span class="keyword">public</span> void Bark()&#123;</div><div class="line"> <span class="keyword">try</span>&#123;</div><div class="line">  System.out.println(<span class="string">"Bark~~~ "</span>);</div><div class="line"> &#125;<span class="keyword">catch</span>(<span class="keyword">Exception</span> err)&#123;</div><div class="line">  System.out.println(<span class="string">"An error occured!"</span>);</div><div class="line"> &#125;</div><div class="line">&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>测试类：TestAnimal</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestAnimal</span> </span>&#123;</div><div class="line"><span class="keyword">public</span> void TestLSP(Animal animal)&#123;</div><div class="line">  <span class="keyword">if</span> (animal <span class="keyword">instanceof</span> Cat )&#123;</div><div class="line">Cat cat = (Cat)animal;</div><div class="line">cat.printName();</div><div class="line">cat.Mew();</div><div class="line">  &#125;</div><div class="line">  <span class="keyword">if</span> (animal <span class="keyword">instanceof</span> Dog )&#123;</div><div class="line"></div><div class="line"> Dog dog = (Dog)animal;</div><div class="line"> dog.printName();</div><div class="line"> dog.Bark();</div><div class="line">  &#125;</div><div class="line"> &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p> 象这种代码是明显不符合里氏代换原则的，它给使用者使用造成很大的麻烦，甚至无法使用，对于以后的维护和扩展带来巨大的隐患。实现开闭原则的关键步骤是抽象化，基类与子类之间的继承关系就是一种抽象化的体现。因此，里氏代换原则是实现抽象化的一种规范。违反里氏代换原则意味着违反了开闭原则，反之未必。里氏代换原则是使代码符合开闭原则的一个重要保证。</p>
<p> 我们常见这样的代码，至少我以前的Java和PHP项目中就出现过。比如有一个网页，要实现对于客户资料的查看、增加、修改、删除功能，一般Server端对应的处理类中都有这么一段：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">if</span>(action.Equals(“add”))&#123;</div><div class="line">  <span class="comment">//do add action</span></div><div class="line">&#125;</div><div class="line"><span class="keyword">else</span> <span class="keyword">if</span>(action.Equals(“view”))&#123;</div><div class="line">  <span class="comment">//do view action</span></div><div class="line">&#125;</div><div class="line"><span class="keyword">else</span> <span class="keyword">if</span>(action.Equals(“delete”))&#123;</div><div class="line">  <span class="comment">//do delete action</span></div><div class="line">&#125;</div><div class="line"><span class="keyword">else</span> <span class="keyword">if</span>(action.Equals(“modify”))&#123;</div><div class="line">  <span class="comment">//do modify action</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>大家都很熟悉吧，其实这是违背里氏代换原则的，结果就是可维护性和可扩展性会变差。有人说：我这么用，效果好像不错，干嘛讲究那么多呢，实现需求是第一位的。另外，这种写法看起来很很直观的，有利于维护。其实，每个人所处的环境不同，对具体问题的理解不同，难免局限在自己的领域内思考问题。对于这个说法，我觉得应该这么解释：作为一个设计原则，是人们经过很多的项目实践，最终提炼出来的指导性的内容。如果对于你的项目来讲，显著增加了工作量和复杂度，那我觉得适度的违反并不为过。做任何事情都是个度的问题，过犹不及都不好。在大中型的项目中，是一定要讲究软件工程的思想，讲究规范和流程的，否则人员协作和后期维护将会是非常困难的。对于小型的项目可能相应的要简化很多，可能取决于时间、资源、商业等各种因素，但是多从软件工程的角度去思考问题，对于系统的健壮性、可维护性等性能指标的提高是非常有益的。像生命周期只有一个月的系统，你还去考虑一大堆原则，除非脑袋被驴踢了。<br> 实现开闭原则的关键步骤是抽象化，基类与子类之间的继承关系就是一种抽象化的体现。因此，里氏代换原则是实现抽象化的一种规范。违反里氏代换原则意味着违反了开闭原则，反之未必。里氏代换原则是使代码符合开闭原则的一个重要保证。</p>
<p>通过里氏代换原则给我们带来了什么样的启示？<br> 类的继承原则：如果一个继承类的对象可能会在基类出现的地方出现运行错误，则该子类不应该从该基类继承，或者说，应该重新设计它们之间的关系。<br> 动作正确性保证：符合里氏代换原则的类扩展不会给已有的系统引入新的错误。</p>
<h2 id="架构师之路-39-—IoC框架"><a href="#架构师之路-39-—IoC框架" class="headerlink" title="架构师之路(39)—IoC框架"></a>架构师之路(39)—IoC框架</h2><h3 id="1-IoC理论的背景"><a href="#1-IoC理论的背景" class="headerlink" title="1 IoC理论的背景"></a>1 IoC理论的背景</h3><p> 我们都知道在面向对象的应用中，软件系统都是由N个对象组成的，它们通过彼此的合作，最终实现业务逻辑。</p>
<p><img src="http://ojlt0g866.bkt.clouddn.com/blog/20170424/091605214.png" alt="mark"></p>
<p>图1：耦合在一起的对象</p>
<p> 如果我们打开机械式手表的后盖，就会看到与上面类似的情形，各个齿轮分别带动时针、分针和秒针顺时针旋转，从而在表盘上产生正确的时间。上图画的就是这样 的一个齿轮组，它拥有多个独立的齿轮，这些齿轮相互啮合在一起，协同工作，来共同完成某项任务。我们可以看到，在齿轮组中，如果有一个齿轮出了问题，就可 能会影响到整个齿轮组的运转。</p>
<p> 齿轮组中各个齿轮之间的啮合关系,与软件系统中对象与对象之间的耦合关系，非常类似。对象之间的耦合关系是必要的，是协同工作的基础，当然也是无法避免 的，否则无法保证系统整体的正常运转。目前，很多工业级的应用越来越庞大，对象之间的依赖关系也越来越复杂，就会出现对象之间的多重依赖性关系，因此，架 构师和设计师对系统进行分析和设计将面临很大的挑战。对象之间耦合度过高的系统，必然会出现牵一发而动全身的情形。</p>
<p> <img src="http://ojlt0g866.bkt.clouddn.com/blog/20170424/091622738.png" alt="mark"></p>
<p>图2：对象之间复杂的依赖关系</p>
<p> 耦合关系不仅会出现在对象与对象之间，也会出现在软件系统的各模块之间，以及软件系统和硬件系统之间。如何降低系统之间、模块之间和对象之间的耦合度，是软件工程永远追求的目标之一。<br> 所以有人就提出来IOC理论，用来实现对象之间的“解耦”，目前已被广泛应用于很多项目中。</p>
<h3 id="2-什么是控制反转-IoC"><a href="#2-什么是控制反转-IoC" class="headerlink" title="2 什么是控制反转(IoC)"></a>2 什么是控制反转(IoC)</h3><p> IoC是Inversion of Control的缩写，多数书籍翻译成“控制反转”，还有些书籍翻译成为“控制反向”或者“控制倒置”，这些都大同小异，我个人觉得这个翻译有待商榷，容易引起歧义，是不是翻译为 “控制转移”会更好一些。<br> 1996年，Michael Mattson在一篇有关探讨面向对象框架的文章中，首先提出了IoC 这个概念。对于面向对象设计及编程的基本思想，前面我们已经讲了很多了，不再赘述，读者可以参考我前面的文章，简单来说就是把复杂系统分解成相互合作的对 象，这些对象类的内部实现是透明的，从而降低了解决问题的复杂度，而且可以灵活地被重用和扩展。IoC理论提出的观点大体是这样的：借助于“第三方”实现 具有依赖关系的对象之间的解耦，如下图：</p>
<p> <img src="http://ojlt0g866.bkt.clouddn.com/blog/20170424/091639707.png" alt="mark"></p>
<p> 图3：IoC解耦示意图</p>
<p> 大家看到了吧，由于引进了中间的“第三方”，也就是IoC容器，使得A、B、C、D这4个对象没有了耦合关系，齿轮之间的传动全部依靠“第三方”了，所有 对象的控制权全部上缴给“第三方”，这就是“控制反转”说法的由来，意思就是各个对象的控制权都被转移给“第三方”了。<br> 从另一个角度来看，作为“第三方”的IoC容器成了整个系统的关键核心，它起到了一种类似“粘合剂”的作用，把系统中的所有对象粘合在一起发挥作用，如果没有这个“粘合剂”，对象与对象之间会彼此失去联系，这就是所谓的Ioc容器被称为“粘合剂”的原因。<br> 我们再把上图中间的Ioc容器拿掉后，整个系统变为这样的情形：<br><img src="http://ojlt0g866.bkt.clouddn.com/blog/20170424/091655549.png" alt="mark"></p>
<p>图4：拿掉IoC容器后的系统</p>
<p> 拿掉IoC容器后，我们看到的就是系统开发所需要完成的全部内容，这时候，A、B、C、D这4个对象之间已经没有了耦合关系，彼此毫不影响，所以当你在实 现Class A的时候，根本不用再考虑B、C和D了，系统对象之间的依赖已经降低到了最低程度。至于IoC容器，你可以到开源组织的网站上找一找，里面有很多比较成熟 而且Free的，使用起来非常简便。<br>如果真能实现控制反转，对于系统开发而言，这将是一件多么美好的事情！</p>
<h3 id="3-什么是依赖注入-DI"><a href="#3-什么是依赖注入-DI" class="headerlink" title="3 什么是依赖注入(DI)"></a>3 什么是依赖注入(DI)</h3><p> 我们先看一些生活中的例子，帮助你理解依赖注入(DI)：</p>
<h4 id="3-1-主机和内置硬盘"><a href="#3-1-主机和内置硬盘" class="headerlink" title="3.1 主机和内置硬盘"></a>3.1 主机和内置硬盘</h4><p> 我们平时所用的电脑，它的硬盘安装在主机里面，从电脑的外部，我们是看不见硬盘的。所以，我们通常认为，电脑的所有部件是融为一体的。</p>
<p><img src="http://ojlt0g866.bkt.clouddn.com/blog/20170424/091708153.png" alt="mark"></p>
<p>图5：主机和内置硬盘</p>
<p> 对于一体机而言，一旦出现了问题，我们可能无法准确地判断到底是什么零部件出现了问题，有可能是CPU坏了，也有可能是主板烧了，还有可能是内存松动了。 还有的时候，比如，电脑硬盘出现了问题，可能导致整台电脑都无法使用。从这个例子，我们可以看到部件之间“紧密耦合”的产生的问题：无法准确的定位和诊断 故障所在。这种情形，在软件工程的理论中，称之为可理解性和可测试性差。</p>
<p> 如果你想修理电脑的硬盘，那么在修理过程中就必须小心翼翼，不要把其它的部件再搞坏了，比如不慎把内存给碰松动了，硬盘固然是修好了，但整台电脑仍然无法使用。这种情形，在软件工程的理论中，称之为可修改性差。<br>可理解性、可测试性、可修改性组成了系统的可维护性，一体机的可维护性就表现得比较差。</p>
<h4 id="3-2-主机和USB设备"><a href="#3-2-主机和USB设备" class="headerlink" title="3.2 主机和USB设备"></a>3.2 主机和USB设备</h4><p> 大家对USB接口和设备应该都很熟悉。自从有了USB接口，给我们使用电脑带来了很大的方便，现在有很多的外部设备都支持USB接口。</p>
<p><img src="http://ojlt0g866.bkt.clouddn.com/blog/20170424/091723049.png" alt="mark"></p>
<p>图6：主机和USB设备</p>
<p> 从软件工程角度，我们分析一下USB带来的好处：<br>1、USB设备作为主机的外部设备，在插入主机之前，与主机没有任何的关系，两者都可独立进行测试，无论两者中的任何一方出现什么的问题，都不会影响另一方的运行，所以可维护性比较好。<br>2、同一个USB设备可以插接到不同的支持USB的任何主机，也就是USB设备可以被重复利用，所以可复用性比较好。<br>3、支持热插拔，只要是支持USB接口的设备都可以接入，所以可扩展性比较好，非常灵活。</p>
<h4 id="3-3-依赖注入"><a href="#3-3-依赖注入" class="headerlink" title="3.3 依赖注入"></a>3.3 依赖注入</h4><p> 2004年，Martin Fowler从另一个角度来思考这个问题，提出了“哪些方面的控制被反转了？”这样一个问题，并给出了答案：“依赖对象的获得被反转”。于是，他给“控制 反转”取了一个他认为更合适的名字叫做“依赖注入（Dependency Injection）”。他的这个答案，实际上点明了实现IoC理论的解决方法。所谓依赖注入，就是由IoC容器在运行期间，动态地将某种依赖关系注入到 对象之中。</p>
<p> 依赖注入(DI)和控制反转(IoC)是从不同的角度的描述的同一件事情，都是指通过引入第三方，即IoC容器，实现软件系统中对象之间的解耦。</p>
<p> 控制反转能够带给系统开发的好处，与USB机制带来的好处基本类似，而且依赖注入的实现跟USB机制也完全一样。USB机制是现实中依赖注入的很好的案例。我们用一个实际的例子，分析一下USB机制：</p>
<p>任务：主机通过USB接口读取一个文件。<br>思路：首先，必须制定一个USB接口标准，主机对USB设备的访问严格按照USB接口标准，USB设备提供的功能也必须符合USB接口标准。<br> 当主机需要获取一个文件的时候，它直接去读取USB接口，根本不会关心USB接口上连接的是什么设备。<br>如果我给主机连接上一个U盘，那么主机就从U盘上读取文件；如果我给主机连接上一个外接硬盘，那么主机就从外接硬盘上读取文件。选取何种外部设备的权力由我说了算，也就是控制权归我。<br>至此,依赖注入的思路已经非常清楚：当主机需要读取文件的时候，我就把它所要依赖的外部设备，挑出来一个，帮他挂接上。这个过程就是一个被依赖的对象在系统运行时被注入另外一个对象内部的过程。在这个过程中，我就起到了IoC容器的作用。</p>
<p> 我们再把依赖注入应用到软件工程中：<br> Class A依赖于Class B,当Class A需要用到Class B的时候，IoC容器就会立刻创建一个Class B送给Class A使用。IoC容器就是一个类制造工厂，你需要什么，直接来拿，直接用就可以了，而不需要去关心你所用的东西是如何制成的，也不用关心最后是怎么被销毁 的，这一切全由IoC容器包办。</p>
<h3 id="4-实现IoC容器"><a href="#4-实现IoC容器" class="headerlink" title="4 实现IoC容器"></a>4 实现IoC容器</h3><hr>
<p>后记：之所以突然跳跃到39，是因为有的同学基础比较好，已经没有必要阅读有关面向对象、设 计模式以及软件工程的基本理论，那么可以从这里开始阅读。基础需要继续补全的同学，可以从4继续看，我会定期在两个方向进行更新。框架理论，是架构师知识 体系中非常重要的部分，我会逐步结合实例，把常见的一些框架方面的知识与大家共享。</p>
<h2 id="里氏替换原则"><a href="#里氏替换原则" class="headerlink" title="里氏替换原则"></a>里氏替换原则</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&lt;?php</span></div><div class="line"></div><div class="line"><span class="comment">//例子1</span></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Bird</span></span>&#123;</div><div class="line"></div><div class="line">    protect <span class="function"><span class="keyword">function</span> <span class="title">fly</span><span class="params">()</span></span>&#123;</div><div class="line">    </div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"><span class="comment">//翠鸟</span></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">KingFisher</span> <span class="keyword">extends</span> <span class="title">Bird</span></span>&#123;</div><div class="line"></div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">//鸵鸟</span></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Ostrich</span> <span class="keyword">extends</span> <span class="title">Bird</span></span>&#123;</div><div class="line">    <span class="comment">//鸵鸟不会飞啊</span></div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">//例子2</span></div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span></span>&#123;</div><div class="line">    protect <span class="function"><span class="keyword">function</span> <span class="title">add</span><span class="params">($a, $b)</span></span>&#123;</div><div class="line">        <span class="keyword">return</span> $a + $b;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">//重载</span></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">B</span> <span class="keyword">extends</span> <span class="title">A</span></span>&#123;</div><div class="line"></div><div class="line">    <span class="keyword">protected</span> <span class="function"><span class="keyword">function</span> <span class="title">add</span><span class="params">($a, $b)</span></span>&#123;</div><div class="line">        <span class="keyword">return</span> $a + $b + <span class="number">100</span>;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"><span class="meta">?&gt;</span></div></pre></td></tr></table></figure>
<p>里氏替换原则是对类继承的一种约束。对里氏替换原则有两种理解：</p>
<p>不能随便去继承不合适的，有多余方法或者属性的类。（例子1）</p>
<p>子类可以扩展父类的功能，但不能改变父类原有的功能。（例子2）</p>
<p>看了第二个例子，有人会说那岂不是和重载矛盾了。初看是有点，但仔细理解，并不矛盾，我们可以这样处理矛盾：</p>
<p>//例子2</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span></span>&#123;</div><div class="line">    protect <span class="function"><span class="keyword">function</span> <span class="title">add</span><span class="params">($a, $b)</span></span>&#123;</div><div class="line">        <span class="keyword">return</span> $a + $b;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">//重载</span></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">B</span> <span class="keyword">extends</span> <span class="title">A</span></span>&#123;</div><div class="line"></div><div class="line">    <span class="keyword">protected</span> <span class="function"><span class="keyword">function</span> <span class="title">add</span><span class="params">($a, $b, $c)</span></span>&#123;</div><div class="line">        <span class="keyword">return</span> <span class="keyword">isset</span>($c) ? $a + $b + <span class="number">100</span> : $a + $b;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>里氏替换原则包含一下几个隐藏含义：</p>
<p>子类可以实现父类的抽象方法，但不能覆盖父类的非抽象方法。</p>
<p>子类中可以增加自己特有的方法。</p>
<p>当子类的方法重载父类的方法时，方法的前置条件（即方法的形参）要比父类方法的输入参数更宽松。</p>
<p>当子类的方法实现父类的抽象方法时，方法的后置条件（即方法的返回值）要比父类更严格。</p>
]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;架构师之路-1-—面向过程和面向对象&quot;&gt;&lt;a href=&quot;#架构师之路-1-—面向过程和面向对象&quot; class=&quot;headerlink&quot; title=&quot;架构师之路(1)—面向过程和面向对象&quot;&gt;&lt;/a&gt;架构师之路(1)—面向过程和面向对象&lt;/h2&gt;&lt;p&gt;自学收集，如需观看，请访问原文。&lt;br&gt;&lt;a href=&quot;http://blog.csdn.net/phphot/article/details/4050193&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;http://blog.csdn.net/phphot/article/details/4050193&lt;/a&gt;&lt;/p&gt;
&lt;h3 id=&quot;1、引言&quot;&gt;&lt;a href=&quot;#1、引言&quot; class=&quot;headerlink&quot; title=&quot;1、引言&quot;&gt;&lt;/a&gt;1、引言&lt;/h3&gt;&lt;p&gt;机算机科学是一门应用科学，它的知识体系是典型的倒三角结构，所用的基础知识并不多，只 是随着应用领域和方向的不同，产生了很多的分支，所以说编程并不是一件很困难的事情，一个高中生经过特定的训练就可以做得到。但是，会编程和编好程绝对是 两码事，同样的程序员，有的人几年之后成为了架构师，有的人却还在不停地coding，只不过ctrl-c、ctrl-v用得更加纯熟了。在中国，编程人 员最终的归途无外乎两条：一是转向技术管理，它的终点是CTO；二是继续深入，它的终点是首席架构师，成为CEO的人毕竟是少数。如果你现在还是个普通的 程序员，希望继续在技术这条路上前进的话，我想你还是应该先补充一点软件工程的思想，学习一点有关设计模式的知识，只有具备这些能力，你才能从整体和宏观 层面来考虑问题、分析问题和解决问题。本人Coding了很多年，中间走了不少弯路，虽然最终没什么大成就，但总算有一些心得，很愿意把自己的一些经验拿 出来跟大家分享，这或许对你的发展有所帮助。&lt;/p&gt;
&lt;p&gt;由程序员转为架构师，最绕不开的概念就算是面向对象(OO)了。记得在大学的时候，我们专业开了一门课叫《面向对象的编程》。那个时候，我们刚刚学 了一门C语言，开发环境用的还是DOS下的Turbo C，半点项目开发的经验都没有，纯粹的空对空。所以，一学期下来，我始终处于一种懵懂状态，既没领会面向过程和面向对象到底有什么区别，也没搞懂面向对象 能带来什么好处。&lt;/p&gt;
    
    </summary>
    
      <category term="架构师之路" scheme="http://sunhao.win/categories/%E6%9E%B6%E6%9E%84%E5%B8%88%E4%B9%8B%E8%B7%AF/"/>
    
    
      <category term="设计模式" scheme="http://sunhao.win/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"/>
    
  </entry>
  
  <entry>
    <title>php-disign-pattern设计模式</title>
    <link href="http://sunhao.win/articles/php-disign-pattern.html"/>
    <id>http://sunhao.win/articles/php-disign-pattern.html</id>
    <published>2017-04-21T01:13:29.000Z</published>
    <updated>2017-04-21T01:31:04.255Z</updated>
    
    <content type="html"><![CDATA[<p>单一职责:1避免职责分散，2避免职责过于集中。关键词 整体 部分。原子</p>
<p>接口隔离:意思是不应该强迫实现一些不会使用的接口 关键词 原子</p>
<p>开放-封闭原则:一个模块扩展是开放的，核心是封闭的。  这里的关键是 抽象，因为抽象具有稳定性</p>
<p>替换原则:子类必须能够替换成他们的基类<br><a id="more"></a></p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;单一职责:1避免职责分散，2避免职责过于集中。关键词 整体 部分。原子&lt;/p&gt;
&lt;p&gt;接口隔离:意思是不应该强迫实现一些不会使用的接口 关键词 原子&lt;/p&gt;
&lt;p&gt;开放-封闭原则:一个模块扩展是开放的，核心是封闭的。  这里的关键是 抽象，因为抽象具有稳定性&lt;/p&gt;
&lt;p&gt;替换原则:子类必须能够替换成他们的基类&lt;br&gt;
    
    </summary>
    
      <category term="php" scheme="http://sunhao.win/categories/php/"/>
    
    
      <category term="php" scheme="http://sunhao.win/tags/php/"/>
    
      <category term="设计模式" scheme="http://sunhao.win/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"/>
    
  </entry>
  
  <entry>
    <title>linux-shell-/bin/bash^M错误</title>
    <link href="http://sunhao.win/articles/linux-shell-bin-bashM.html"/>
    <id>http://sunhao.win/articles/linux-shell-bin-bashM.html</id>
    <published>2017-04-20T07:38:56.000Z</published>
    <updated>2017-04-20T07:55:22.927Z</updated>
    
    <content type="html"><![CDATA[<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">bash: ./du2.sh: /bin/bash^M: bad interpreter: No such file or directory</div></pre></td></tr></table></figure>
<p>在win平台下输入/bin/bash的脚本,运行报错。</p>
<p>因为win下默认编辑器的回车是crlf。改成lf就好了</p>
<a id="more"></a>
<p>while read 可以读取文件的每一行.<br>read -p 可以读取指令。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">#!/bin/bash</div><div class="line">cat 2 | while read line</div><div class="line">do</div><div class="line">    echo &quot;$line&quot;</div><div class="line">done</div><div class="line"></div><div class="line">read -p &quot;niaiwome?&quot; name</div><div class="line"></div><div class="line">echo &quot;$name&quot;</div></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;bash: ./du2.sh: /bin/bash^M: bad interpreter: No such file or directory&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;在win平台下输入/bin/bash的脚本,运行报错。&lt;/p&gt;
&lt;p&gt;因为win下默认编辑器的回车是crlf。改成lf就好了&lt;/p&gt;
    
    </summary>
    
      <category term="linux" scheme="http://sunhao.win/categories/linux/"/>
    
    
      <category term="shell" scheme="http://sunhao.win/tags/shell/"/>
    
  </entry>
  
  <entry>
    <title>linux-while-do-case与js和python,php对比</title>
    <link href="http://sunhao.win/articles/linux-while-do.html"/>
    <id>http://sunhao.win/articles/linux-while-do.html</id>
    <published>2017-04-20T02:57:23.000Z</published>
    <updated>2017-04-20T03:14:07.526Z</updated>
    
    <content type="html"><![CDATA[<p>case … esac 与其他语言中的 switch … case 语句类似，是一种多分枝选择结构。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">while command</div><div class="line">do</div><div class="line">   Statement(s) to be executed if command is true</div><div class="line">done</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line">case 值 in</div><div class="line">模式1)</div><div class="line">    command1</div><div class="line">    command2</div><div class="line">    command3</div><div class="line">    ;;</div><div class="line">模式2）</div><div class="line">    command1</div><div class="line">    command2</div><div class="line">    command3</div><div class="line">    ;;</div><div class="line">*)</div><div class="line">    command1</div><div class="line">    command2</div><div class="line">    command3</div><div class="line">    ;;</div><div class="line">esac</div></pre></td></tr></table></figure>
<a id="more"></a>
<p>js的switch</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">switch</span>(n)</div><div class="line">&#123;</div><div class="line"><span class="keyword">case</span> <span class="number">1</span>:</div><div class="line">  执行代码块 <span class="number">1</span></div><div class="line">  <span class="keyword">break</span>;</div><div class="line"><span class="keyword">case</span> <span class="number">2</span>:</div><div class="line">  执行代码块 <span class="number">2</span></div><div class="line">  <span class="keyword">break</span>;</div><div class="line"><span class="keyword">default</span>:</div><div class="line">  n 与 <span class="keyword">case</span> <span class="number">1</span> 和 <span class="keyword">case</span> <span class="number">2</span> 不同时执行的代码</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>php的switch</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">switch</span> (expression)</div><div class="line">&#123;</div><div class="line"><span class="keyword">case</span> label1:</div><div class="line">  code to be executed <span class="keyword">if</span> expression = label1;</div><div class="line">  <span class="keyword">break</span>;  </div><div class="line"><span class="keyword">case</span> label2:</div><div class="line">  code to be executed <span class="keyword">if</span> expression = label2;</div><div class="line">  <span class="keyword">break</span>;</div><div class="line"><span class="keyword">default</span>:</div><div class="line">  code to be executed</div><div class="line">  <span class="keyword">if</span> expression is different </div><div class="line">  from both label1 <span class="keyword">and</span> label2;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>python的switch<br>python本身没有switch语句，解决方法有以下3种:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">A.使用dictionary</div><div class="line">values = &#123;</div><div class="line">           value1: do_some_stuff1,</div><div class="line">           value2: do_some_stuff2,</div><div class="line">           ...</div><div class="line">           valueN: do_some_stuffN,</div><div class="line">         &#125;</div><div class="line">values.get(var, do_default_stuff)()</div><div class="line">B.使用<span class="keyword">lambda</span></div><div class="line">result = &#123;</div><div class="line">  <span class="string">'a'</span>: <span class="keyword">lambda</span> x: x * <span class="number">5</span>,</div><div class="line">  <span class="string">'b'</span>: <span class="keyword">lambda</span> x: x + <span class="number">7</span>,</div><div class="line">  <span class="string">'c'</span>: <span class="keyword">lambda</span> x: x - <span class="number">2</span></div><div class="line">&#125;[value](x)</div><div class="line">C.使用引用类</div></pre></td></tr></table></figure>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;case … esac 与其他语言中的 switch … case 语句类似，是一种多分枝选择结构。&lt;/p&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;while command&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;do&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;   Statement(s) to be executed if command is true&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;done&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;6&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;7&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;8&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;9&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;10&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;11&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;12&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;13&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;14&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;15&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;16&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;17&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;case 值 in&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;模式1)&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    command1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    command2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    command3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    ;;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;模式2）&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    command1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    command2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    command3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    ;;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;*)&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    command1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    command2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    command3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    ;;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;esac&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
    
    </summary>
    
      <category term="linux" scheme="http://sunhao.win/categories/linux/"/>
    
    
      <category term="whiledo" scheme="http://sunhao.win/tags/whiledo/"/>
    
  </entry>
  
  <entry>
    <title>mysql-mysql5.7-[Err]1067-Invaliddefaultvaluefor</title>
    <link href="http://sunhao.win/articles/mysql-mysql5-7-Err-1067-Invaliddefaultvaluefor.html"/>
    <id>http://sunhao.win/articles/mysql-mysql5-7-Err-1067-Invaliddefaultvaluefor.html</id>
    <published>2017-04-19T08:31:22.000Z</published>
    <updated>2017-05-09T02:41:24.664Z</updated>
    
    <content type="html"><![CDATA[<p>升级到mysql5.7后，还原数据出现[Err]1067-Invaliddefaultvaluefor，更改mysqld组的sql_mode.<br>5.7在/etc/mysql/mysql.conf.d/mysqld.cnf</p>
<pre><code>[mysqld]
#
# * Basic Settings
#
user            = mysql
pid-file        = /var/run/mysqld/mysqld.pid
socket          = /var/run/mysqld/mysqld.sock
port            = 3306
basedir         = /usr
datadir         = /var/lib/mysql
tmpdir          = /tmp
lc-messages-dir = /usr/share/mysql
skip-external-locking
sql_mode        = ALLOW_INVALID_DATES
</code></pre><p>设置完后，查询下，如果是ALLOW_INVALID_DATES说明改成功。否则检查下。<br><figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">mysql&gt; select @@sql_mode;   </div><div class="line">+----------------------------------------------------------------+   </div><div class="line">| @@sql_mode                                                     |   </div><div class="line">+----------------------------------------------------------------+   </div><div class="line">| STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION |   </div><div class="line">+----------------------------------------------------------------+</div></pre></td></tr></table></figure></p>
<a id="more"></a>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;升级到mysql5.7后，还原数据出现[Err]1067-Invaliddefaultvaluefor，更改mysqld组的sql_mode.&lt;br&gt;5.7在/etc/mysql/mysql.conf.d/mysqld.cnf&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;[mysqld]
#
# * Basic Settings
#
user            = mysql
pid-file        = /var/run/mysqld/mysqld.pid
socket          = /var/run/mysqld/mysqld.sock
port            = 3306
basedir         = /usr
datadir         = /var/lib/mysql
tmpdir          = /tmp
lc-messages-dir = /usr/share/mysql
skip-external-locking
sql_mode        = ALLOW_INVALID_DATES
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;设置完后，查询下，如果是ALLOW_INVALID_DATES说明改成功。否则检查下。&lt;br&gt;&lt;figure class=&quot;highlight&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;6&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;mysql&amp;gt; select @@sql_mode;   &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;+----------------------------------------------------------------+   &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;| @@sql_mode                                                     |   &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;+----------------------------------------------------------------+   &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;| STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION |   &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;+----------------------------------------------------------------+&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
    
    </summary>
    
      <category term="mysql" scheme="http://sunhao.win/categories/mysql/"/>
    
    
      <category term="Err1067" scheme="http://sunhao.win/tags/Err1067/"/>
    
  </entry>
  
  <entry>
    <title>php-php7-fpm默认监听的scok</title>
    <link href="http://sunhao.win/articles/php-php7-listen.html"/>
    <id>http://sunhao.win/articles/php-php7-listen.html</id>
    <published>2017-04-19T08:26:29.000Z</published>
    <updated>2017-04-19T08:43:13.227Z</updated>
    
    <content type="html"><![CDATA[<p>php7-fpm默认监听的sock。和以前不一样 。以前是监听9000端口。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line">server &#123;</div><div class="line"></div><div class="line">        listen 80;</div><div class="line"></div><div class="line">        server_name ityhc.com www.ityhc.com;</div><div class="line">        root /var/www/html/ityhc;</div><div class="line">        index index.html index.htm index.php;   </div><div class="line"></div><div class="line">        location ~ \.php?.*$ &#123;  </div><div class="line">        root /var/www/html/ityhc;</div><div class="line">        fastcgi_index index.php;</div><div class="line">        fastcgi_pass unix:/run/php/php7.0-fpm.sock;</div><div class="line">        fastcgi_param  SCRIPT_FILENAME  $document_root$fastcgi_script_name;  </div><div class="line">        include        fastcgi_params;  </div><div class="line">    &#125;  </div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<a id="more"></a>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;php7-fpm默认监听的sock。和以前不一样 。以前是监听9000端口。&lt;/p&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;6&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;7&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;8&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;9&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;10&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;11&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;12&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;13&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;14&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;15&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;16&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;17&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;server &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        listen 80;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        server_name ityhc.com www.ityhc.com;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        root /var/www/html/ityhc;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        index index.html index.htm index.php;   &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        location ~ \.php?.*$ &amp;#123;  &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        root /var/www/html/ityhc;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        fastcgi_index index.php;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        fastcgi_pass unix:/run/php/php7.0-fpm.sock;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        fastcgi_param  SCRIPT_FILENAME  $document_root$fastcgi_script_name;  &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        include        fastcgi_params;  &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &amp;#125;  &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;#125;&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
    
    </summary>
    
      <category term="php" scheme="http://sunhao.win/categories/php/"/>
    
    
      <category term="listen" scheme="http://sunhao.win/tags/listen/"/>
    
  </entry>
  
  <entry>
    <title>php-interfaces-and-traits</title>
    <link href="http://sunhao.win/articles/php-interfaces-and-traits.html"/>
    <id>http://sunhao.win/articles/php-interfaces-and-traits.html</id>
    <published>2017-04-18T00:37:27.000Z</published>
    <updated>2017-04-18T09:36:44.000Z</updated>
    
    <content type="html"><![CDATA[<h3 id="interfaces和traits-超强组合"><a href="#interfaces和traits-超强组合" class="headerlink" title="interfaces和traits,超强组合"></a>interfaces和traits,超强组合</h3><p>译者注:<br>老歪，写的文章特别详细，一句话会说好几遍，语义我删减了点。但尽可能保持原意。<br>如果你还没有用php的interfaces, 会错过面向对象的强大特性.  在PHP 5.4中Interfaces和traits配合十分强大.<br>Interfaces不在类中，类必须实现interface里约定的方法. </p>
<p>假设我们有个User的类. Users有个地址，我们把地址通过应用邮件包传给PackageShipper（托运人） :</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Address</span> </span>&#123;</div><div class="line"> <span class="comment">// ... setters and getters for address fields ...</span></div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">User</span> </span>&#123;</div><div class="line"> <span class="keyword">protected</span> $address;</div><div class="line"></div><div class="line"> <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">setAddress</span><span class="params">(Address $address)</span> </span>&#123;</div><div class="line">  <span class="keyword">$this</span>-&gt;address = $address;</div><div class="line"> &#125;</div><div class="line"></div><div class="line"> <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getAddress</span><span class="params">()</span> </span>&#123;</div><div class="line">  <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;address;</div><div class="line"> &#125;</div><div class="line"></div><div class="line"> <span class="comment">// ... other user logic ...</span></div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">PackageShipper</span> </span>&#123;</div><div class="line"> <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">shipTo</span><span class="params">(User $user)</span> </span>&#123;</div><div class="line">  $address = $user-&gt;getAddress();</div><div class="line"></div><div class="line">  <span class="comment">// ... do shipping code using $address ...</span></div><div class="line"> &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<a id="more"></a>
<p>我们的应用愉快的传递包, 直到有一天我们有个需求， Companies(公司) 也需要传递包. 我们创建一个公司类来处理:</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Company</span> </span>&#123;</div><div class="line"> <span class="keyword">protected</span> $address;</div><div class="line"></div><div class="line"> <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">setAddress</span><span class="params">(Address $address)</span> </span>&#123;</div><div class="line">  <span class="keyword">$this</span>-&gt;address = $address;</div><div class="line"> &#125;</div><div class="line"></div><div class="line"> <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getAddress</span><span class="params">()</span> </span>&#123;</div><div class="line">  <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;address;</div><div class="line"> &#125;</div><div class="line"></div><div class="line"> <span class="comment">// ... other company logic ...</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>现在我们遇到一个问题. PackageShipper只知道处理Users. 我们需要PackageShipper类处理任何地址.</p>
<p>我们可以创建基类(就是基本的类) ,Users 和 Companies 集成它,PackageShipper允许任何来至继承 base 的类. 这么做不令人满意. 从含义上讲, Users 和 Companies 是两个不同实体, 他们没有太多的共性用于base继承. 除了地址其他没有一样的了. 还有一些类或许已经继承了别的类, 因为php是单继承的，我们没办法再继承了.</p>
<p>所以, 我们可以用 interface定义一个PackageShipper处理的 Users 和 Companies公共部分 . 然后, Users 和 Companies继承interface, PackageShipper只需要处理继承接口的对象.</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div></pre></td><td class="code"><pre><div class="line">inteface Addressable &#123;</div><div class="line"> <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">setAddress</span><span class="params">(Address $address)</span></span>;</div><div class="line"> <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getAddress</span><span class="params">()</span></span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">User</span> <span class="keyword">implements</span> <span class="title">Addressable</span> </span>&#123;</div><div class="line"> <span class="keyword">protected</span> $address;</div><div class="line"></div><div class="line"> <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">setAddress</span><span class="params">(Address $address)</span> </span>&#123;</div><div class="line">  <span class="keyword">$this</span>-&gt;address = $address;</div><div class="line"> &#125;</div><div class="line"></div><div class="line"> <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getAddress</span><span class="params">()</span> </span>&#123;</div><div class="line">  <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;address;</div><div class="line"> &#125;</div><div class="line"></div><div class="line"> <span class="comment">// ... other user logic ...</span></div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Company</span> <span class="keyword">implements</span> <span class="title">Addressable</span> </span>&#123;</div><div class="line"> <span class="keyword">protected</span> $address;</div><div class="line"></div><div class="line"> <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">setAddress</span><span class="params">(Address $address)</span> </span>&#123;</div><div class="line">  <span class="keyword">$this</span>-&gt;address = $address;</div><div class="line"> &#125;</div><div class="line"></div><div class="line"> <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getAddress</span><span class="params">()</span> </span>&#123;</div><div class="line">  <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;address;</div><div class="line"> &#125;</div><div class="line"></div><div class="line"> <span class="comment">// ... other company logic ...</span></div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">PackageShipper</span> </span>&#123;</div><div class="line"> <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">shipTo</span><span class="params">(Addressable $entity)</span> </span>&#123;</div><div class="line">  $address = $entity-&gt;getAddress();</div><div class="line"></div><div class="line">  <span class="comment">// ... do shipping code using $address ...</span></div><div class="line"> &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>一个类可以继承多个不同interfaces, 不同基类可以继承同样的interface.</p>
<p>但是这还是有一个问题. Company和User 用同样代码继承Addressable . 这样太浪费了;只要还有接口约束, 继承来至接口类没必要都一样. 但是, 它们都继承了接口, 我们要复制代码. 如果还要第三个Addressable,同样继承interface, 将会带来更多的重复.</p>
<p>如果你使用PHP 5.3 版本以下, 没办法解决的. 但是如果使用PHP 5.4, 有种新的方式可以解决这种问题: traits.</p>
<p>trait类似于类，因为它们都实现方法和属性。不同的是，类可以实例化，但是trait不能。相反，trait可以添加到类定义，给该类的所有定义的方法和属性定义在trait中</p>
<p>traits就像一个宏一样:在类中使用traits和traits中的代码复制到类是一样的。</p>
<p>用traits,我们可以清除重复的代码 ，保持Addressable接口的定义:</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">trait</span> AddressAccessor &#123;</div><div class="line"> <span class="keyword">protected</span> $address;</div><div class="line"></div><div class="line"> <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">setAddress</span><span class="params">(Address $address)</span> </span>&#123;</div><div class="line">  <span class="keyword">$this</span>-&gt;address = $address;</div><div class="line"> &#125;</div><div class="line"></div><div class="line"> <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getAddress</span><span class="params">()</span> </span>&#123;</div><div class="line">  <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;address;</div><div class="line"> &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">User</span> <span class="keyword">implements</span> <span class="title">Addressable</span> </span>&#123;</div><div class="line"> <span class="keyword">use</span> <span class="title">AddressAccessor</span>;</div><div class="line"></div><div class="line"> <span class="comment">// ... other user logic ...</span></div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Company</span> <span class="keyword">implements</span> <span class="title">Addressable</span> </span>&#123;</div><div class="line"> <span class="keyword">use</span> <span class="title">AddressAccessor</span>;</div><div class="line"></div><div class="line"> <span class="comment">// ... other company logic ...</span></div></pre></td></tr></table></figure>
<p> 现在，任何类可以通过AddressAccessor trait继承Addressable接口 . 重复的代码都可以移除.</p>
<p>trait本身不继承Addressable. 这就是为什么只有classes 可以继承 interfaces. 注意trait的优先级别要小于类里面的。</p>
<p>Interfaces保证 PHP执行正确的代码. 和traits结合, 定义了一个快速开发的强大工具, 减少重复的代码,更易读,更好维护.</p>
<p>下面是应用的最终代码</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Address</span> </span>&#123;</div><div class="line"> <span class="comment">// ... setters and getters for address fields ...</span></div><div class="line">&#125;</div><div class="line"></div><div class="line">inteface Addressable &#123;</div><div class="line"> <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">setAddress</span><span class="params">(Address $address)</span></span>;</div><div class="line"> <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getAddress</span><span class="params">()</span></span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">trait</span> AddressAccessor &#123;</div><div class="line"> <span class="keyword">protected</span> $address;</div><div class="line"></div><div class="line"> <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">setAddress</span><span class="params">(Address $address)</span> </span>&#123;</div><div class="line">  <span class="keyword">$this</span>-&gt;address = $address;</div><div class="line"> &#125;</div><div class="line"></div><div class="line"> <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getAddress</span><span class="params">()</span> </span>&#123;</div><div class="line">  <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;address;</div><div class="line"> &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">User</span> <span class="keyword">implements</span> <span class="title">Addressable</span> </span>&#123;</div><div class="line"> <span class="keyword">use</span> <span class="title">AddressAccessor</span>;</div><div class="line"></div><div class="line"> <span class="comment">// ... other user logic ...</span></div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Company</span> <span class="keyword">implements</span> <span class="title">Addressable</span> </span>&#123;</div><div class="line"> <span class="keyword">use</span> <span class="title">AddressAccessor</span>;</div><div class="line"></div><div class="line"> <span class="comment">// ... other company logic ...</span></div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">PackageShipper</span> </span>&#123;</div><div class="line"> <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">shipTo</span><span class="params">(Addressable $entity)</span> </span>&#123;</div><div class="line">  $address = $entity-&gt;getAddress();</div><div class="line"></div><div class="line">  <span class="comment">// ... do shipping code using $address ...</span></div><div class="line"> &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p> 简单点说，接口用于限制，traits减少重复代码。</p>
<p>原文:<br><a href="http://blog.everymansoftware.com/2012/09/interfaces-and-traits-powerful-combo.html" target="_blank" rel="external">http://blog.everymansoftware.com/2012/09/interfaces-and-traits-powerful-combo.html</a></p>
]]></content>
    
    <summary type="html">
    
      &lt;h3 id=&quot;interfaces和traits-超强组合&quot;&gt;&lt;a href=&quot;#interfaces和traits-超强组合&quot; class=&quot;headerlink&quot; title=&quot;interfaces和traits,超强组合&quot;&gt;&lt;/a&gt;interfaces和traits,超强组合&lt;/h3&gt;&lt;p&gt;译者注:&lt;br&gt;老歪，写的文章特别详细，一句话会说好几遍，语义我删减了点。但尽可能保持原意。&lt;br&gt;如果你还没有用php的interfaces, 会错过面向对象的强大特性.  在PHP 5.4中Interfaces和traits配合十分强大.&lt;br&gt;Interfaces不在类中，类必须实现interface里约定的方法. &lt;/p&gt;
&lt;p&gt;假设我们有个User的类. Users有个地址，我们把地址通过应用邮件包传给PackageShipper（托运人） :&lt;/p&gt;
&lt;figure class=&quot;highlight php&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;6&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;7&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;8&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;9&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;10&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;11&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;12&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;13&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;14&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;15&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;16&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;17&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;18&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;19&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;20&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;21&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;22&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;23&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;24&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;25&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;class&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;Address&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt; &lt;span class=&quot;comment&quot;&gt;// ... setters and getters for address fields ...&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;#125;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;class&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;User&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt; &lt;span class=&quot;keyword&quot;&gt;protected&lt;/span&gt; $address;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt; &lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;setAddress&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(Address $address)&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;  &lt;span class=&quot;keyword&quot;&gt;$this&lt;/span&gt;-&amp;gt;address = $address;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt; &amp;#125;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt; &lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;getAddress&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;()&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;  &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;$this&lt;/span&gt;-&amp;gt;address;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt; &amp;#125;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt; &lt;span class=&quot;comment&quot;&gt;// ... other user logic ...&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;#125;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;class&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;PackageShipper&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt; &lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;shipTo&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(User $user)&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;  $address = $user-&amp;gt;getAddress();&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;  &lt;span class=&quot;comment&quot;&gt;// ... do shipping code using $address ...&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt; &amp;#125;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;#125;&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
    
    </summary>
    
      <category term="php" scheme="http://sunhao.win/categories/php/"/>
    
    
      <category term="interfaces" scheme="http://sunhao.win/tags/interfaces/"/>
    
      <category term="traits" scheme="http://sunhao.win/tags/traits/"/>
    
  </entry>
  
  <entry>
    <title>linux-fifo</title>
    <link href="http://sunhao.win/articles/linux-fifo.html"/>
    <id>http://sunhao.win/articles/linux-fifo.html</id>
    <published>2017-04-14T08:19:55.000Z</published>
    <updated>2017-04-14T08:19:55.343Z</updated>
    
    <content type="html"><![CDATA[<a id="more"></a>]]></content>
    
    <summary type="html">
    
      &lt;a id=&quot;more&quot;&gt;&lt;/a&gt;
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>linux-mknod</title>
    <link href="http://sunhao.win/articles/linux-mknod.html"/>
    <id>http://sunhao.win/articles/linux-mknod.html</id>
    <published>2017-04-14T05:56:26.000Z</published>
    <updated>2017-04-14T06:09:51.248Z</updated>
    
    <content type="html"><![CDATA[<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">#将其中的1,3这样的数字记录下来，这表示主设备号和次设备号（一般来说主设备号用来区分设备的种类；次设备号则是为了作唯一性区分，标明不同属性——注意，在unix系统中是把设备也当作文件来对待的），在redhat 9下，ls加不加-L参数都无所谓，但是在Solaris下则一定要加上才可以显示</div><div class="line">[root@localhost test1]# ls -lL /dev/null </div><div class="line">crw-rw-rw- 1 root root 1, 3 8月  18 21:56 /dev/null</div><div class="line"></div><div class="line">[root@localhost test1]# mknod /dev/hda3 b 3 7    #创建一个区块</div><div class="line"></div><div class="line">[root@localhost test1]# ls -al /dev/hda3         #查看</div><div class="line">brw-r--r-- 1 root root 3, 7 8月  21 11:01 /dev/hda3</div></pre></td></tr></table></figure>
<ol>
<li><p>mknod命令用于创建Linux中的字符设备文件和块设备文件。</p>
</li>
<li><p>首先要明白什么是设备文件，简单的我们说 操作系统与外部设备（入磁盘驱动器，打印机，modern，终端 等等）都是通过设备文件来进行通信 的，在Unix/Linux系统与外部设备通讯之前，这个设备必须首先要有一个设备文件，设备文件均放在/dev目录下。一般情况下在安装系统的时候系统自动创建了很多已检测到的设备的设备文件，但有时候我们也需要自己手动创建，命令行生成设备文件的方式有 insf，mksf，mknod等等</p>
</li>
<li><p>根据mknod命令的使用参数来看【mknod Name { b | c } Major Minor 】，使用mknod之前，至少要明白以下几点：<br>设备文件类型：分为块设备和字符设备。ls -l /dev 结果显示第一个字段有b<strong><em> 和 c*</em></strong>，这里即标识了块设备和字符设备。<br>字符设备文件—-字符设备文件传送数据给设备的时候，一次传送一个字符，终端，打印机，绘图仪，modern等设备都经过字符设备文件传送数据<br>块设备—系统通过块设备文件存取一个设备的时候，先从内存中的buffer中读或写数据，而不是直接传送数据到物理磁盘，这种方式能有效的提高磁盘和CD-ROMS的I/O性能。磁盘和CD-ROMS即可以使用字符设备文件也可使用块设备文件。</p>
</li>
<li><p>来看看mknod 命令，如果该设备文件你想放在一个特定的文件夹下当然就先创建文件夹<br>mknod 设备文件名[/dev/xyz]  b/c  主号  次号</p>
</li>
</ol>
<a id="more"></a>
<p>Linux对设备管理是以文件管理的形式进行的，各种设备都以文件的形式存放在/dev目录 下，称为设备文件。应用程序可以打开、关闭和读写这些设备文件，完成对设备的操作，就像操作普通的数据文件一样。为了管理这些设备，系统为设备编了号，每 个设备号又分为主设备号和次设备号。主设备号用来区分不同种类的设备，而次设备号用来区分同一类型的多个设备。<br>    Linux为所有的设备文件都提供了统一的操作函数接口，此函数结构使用数据结构struct file_operations。这个数据结构中包括许多操作函数的指针，如open()、close()、read()和write()等，但由于外设 的种类较多，操作方式各不相同。Struct file_operations结构体中的成员为一系列的接口函数，如用于读/写的read/write函数和用于控制的ioctl等。打开一个文件就是 调用这个文件file_operations中的open操作。不同类型的文件有不同的file_operations成员函数，如普通的磁盘数据文件， 接口函数完成磁盘数据块读写操作；而对于各种设备文件，则最终调用各自驱动程序中的I/O函数进行具体设备的操作。这样，应用程序根本不必考虑操作的是设 备还是普通文件，可一律当作文件处理，具有非常清晰统一的I/O接口。所以file_operations是文件层次的I/O接口。</p>
<p>   linux中可以通过mknod命令创建一个设备，具体的使用方法如下</p>
<p>  mknod 的标准形式为:       mknod DEVNAME {b | c}  MAJOR  MINOR</p>
<p>1、DEVNAME是要创建的设备文件名，如果想将设备文件放在一个特定的文件夹下，就需要先用mkdir在dev目录下新建一个目录；</p>
<p>2、 b和c 分别表示块设备和字符设备：</p>
<pre><code>b表示系统从块设备中读取数据的时候，直接从内存的buffer中读取数据，而不经过磁盘； 

c表示字符设备文件与设备传送数据的时候是以字符的形式传送，一次传送一个字符，比如打印机、终端都是以字符的形式传送数据；
</code></pre><p>3、MAJOR和MINOR分别表示主设备号和次设备号：</p>
<pre><code>为了管理设备，系统为每个设备分配一个编号，一个设备号由主设备号和次设备号组成。主设备号标示某一种类的设备，次设备号用来区分同一类型的设备。linux操作系统中为设备文件编号分配了32位无符号整数，其中前12位是主设备号，后20位为次设备号，所以在向系统申请设备文件时主设备号不好超过4095，次设备号不好超过2^20 -1。
</code></pre><p>用法：mknod [选项]… 名称 类型 [主设备号 次设备号]<br>创建指定类型和名称的特殊文件。</p>
<p>长选项必须使用的参数对于短选项时也是必需使用的。<br>  -m, –mode=模式       设置权限模式(类似chmod)，而不是rwxrwxrwx 减umask<br>  -Z, –context=CTX     将对应名称文件的SELinux 安全环境设置为CTX<br>  –help        显示此帮助信息并退出<br>  –version        显示版本信息并退出</p>
<p>当类型为”p”时可不指定主设备号和次设备号，否则它们是必须指定的。<br>如果主设备号和次设备号以”0x”或”0X”开头，它们会被视作十六进制数来<br>解析；如果以”0”开头，则被视作八进制数；其余情况下被视作十进制数。<br>可用的类型包括：</p>
<p>  b      创建(有缓冲的)区块特殊文件<br>  c, u   创建(没有缓冲的)字符特殊文件,虚拟设备<br>  p      创建先进先出(FIFO)特殊文件</p>
<p>注意：您的shell 内含自己的mknod 程序版本，它会覆盖这里所提及的相应<br>版本。请查阅您的shell 文档获知它所支持的选项。</p>
]]></content>
    
    <summary type="html">
    
      &lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;6&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;7&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;8&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;#将其中的1,3这样的数字记录下来，这表示主设备号和次设备号（一般来说主设备号用来区分设备的种类；次设备号则是为了作唯一性区分，标明不同属性——注意，在unix系统中是把设备也当作文件来对待的），在redhat 9下，ls加不加-L参数都无所谓，但是在Solaris下则一定要加上才可以显示&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;[root@localhost test1]# ls -lL /dev/null &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;crw-rw-rw- 1 root root 1, 3 8月  18 21:56 /dev/null&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;[root@localhost test1]# mknod /dev/hda3 b 3 7    #创建一个区块&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;[root@localhost test1]# ls -al /dev/hda3         #查看&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;brw-r--r-- 1 root root 3, 7 8月  21 11:01 /dev/hda3&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;ol&gt;
&lt;li&gt;&lt;p&gt;mknod命令用于创建Linux中的字符设备文件和块设备文件。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;首先要明白什么是设备文件，简单的我们说 操作系统与外部设备（入磁盘驱动器，打印机，modern，终端 等等）都是通过设备文件来进行通信 的，在Unix/Linux系统与外部设备通讯之前，这个设备必须首先要有一个设备文件，设备文件均放在/dev目录下。一般情况下在安装系统的时候系统自动创建了很多已检测到的设备的设备文件，但有时候我们也需要自己手动创建，命令行生成设备文件的方式有 insf，mksf，mknod等等&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;根据mknod命令的使用参数来看【mknod Name { b | c } Major Minor 】，使用mknod之前，至少要明白以下几点：&lt;br&gt;设备文件类型：分为块设备和字符设备。ls -l /dev 结果显示第一个字段有b&lt;strong&gt;&lt;em&gt; 和 c*&lt;/em&gt;&lt;/strong&gt;，这里即标识了块设备和字符设备。&lt;br&gt;字符设备文件—-字符设备文件传送数据给设备的时候，一次传送一个字符，终端，打印机，绘图仪，modern等设备都经过字符设备文件传送数据&lt;br&gt;块设备—系统通过块设备文件存取一个设备的时候，先从内存中的buffer中读或写数据，而不是直接传送数据到物理磁盘，这种方式能有效的提高磁盘和CD-ROMS的I/O性能。磁盘和CD-ROMS即可以使用字符设备文件也可使用块设备文件。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;来看看mknod 命令，如果该设备文件你想放在一个特定的文件夹下当然就先创建文件夹&lt;br&gt;mknod 设备文件名[/dev/xyz]  b/c  主号  次号&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
    
    </summary>
    
      <category term="linux" scheme="http://sunhao.win/categories/linux/"/>
    
    
      <category term="linux" scheme="http://sunhao.win/tags/linux/"/>
    
      <category term="mknod" scheme="http://sunhao.win/tags/mknod/"/>
    
  </entry>
  
</feed>
